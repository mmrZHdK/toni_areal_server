var body=document.getElementById("body"),bodyEm=getEmPixels(body),rem=getEmPixels(),bodyEmWidth=body.clientWidth/bodyEm,bodyRemWidth=body.clientWidth/rem,pagesWidth=$(window).width(),today=new Date;Date.prototype.getWeek=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil(((this-e)/864e5+e.getDay()+1)/7)};var months=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayOfWeek=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],menuChar="N";$(window).scroll(function(){var e=$(window).scrollLeft();0==Math.floor(e/pagesWidth)?menuChar="N":1==Math.floor(e/pagesWidth)?menuChar="A":2==Math.floor(e/pagesWidth)?menuChar="M":3==Math.floor(e/pagesWidth)?menuChar="C":4==Math.floor(e/pagesWidth)&&(menuChar="T"),document.getElementById("menu").innerHTML=menuChar}),$.getJSON("http://www.zhdk.ch/?agenda/feed&mindate=2014-09-19&maxdate=2015-01-01&format=json",null,function(e){agendaData(e)});var agendaData=function(e){for(index=0;index<e.events.length;index++){var t=new Date(1e3*e.events[index].startdatum),n=t.getDate(),a=t.getMonth(),o=t.getFullYear(),i=new Date(1e3*e.events[index].enddatum),d=i.getDate(),s=i.getMonth(),l=i.getFullYear();if(0==e.events[index].endzeit)var m=", "+e.events[index].startzeit_text;else var m=", "+e.events[index].startzeit_text+" - "+e.events[index].endzeit_text;if(0==e.events[index].startzeit)if(0==e.events[index].enddatum)var r=n+"."+months[a]+". "+o+",";else var r=n+"."+months[a]+". "+o+" - "+d+"."+months[s]+". "+l,m="";else var r=dayOfWeek[t.getDay()];$("<div>",{id:"tile"+index,"class":"agendaTile"}).appendTo("#agenda"),$("<span>",{html:e.events[index].titel}).appendTo("#tile"+index),$("<p>",{html:e.events[index].kurzbeschreibung}).appendTo("#tile"+index),$("<span>",{html:r+m}).appendTo("#tile"+index)}};$.get("http://www.corsproxy.com/zfv.ch/de/microsites/gastronomie-im-toni-areal/menueplan",function(e){var t=$(e);drawMensaMenu(t,today)});var drawMensaMenu=function(e,t){var n=t.getWeek(),a=t.getDay(),o=dayOfWeek[t.getDay()],i=t.getDate(),d=t.getMonth(),s=t.getFullYear(),l=o+", "+i+"."+months[d]+". "+s;$("<div>",{id:"mensaTileDate"+a,"class":"mensaTileDate",html:l}).appendTo("#mensa"),$("#mensa").animate({scrollTop:$("#mensaTileDate"+a).position().top},400),e.find("tbody tr").each(function(e){if($(this).data("dayofweek")==a&&$(this).data("weeknumber")==n){var t=$(this).find(":nth-child(1)"),o=$(this).find(":nth-child(2)");$("<div>",{id:"mensaTile"+e,"class":"mensaTile"}).appendTo("#mensa"),$("<span>",{html:t}).appendTo("#mensaTile"+e),$("<p>",{html:o}).appendTo("#mensaTile"+e),$("#mensaMenu").toggle(!0),$("#mensaMenu tr").toggle(!0),$("#mensaTile"+e+" p br:last-child").remove()}}),t.getWeek()==today.getWeek()&&5!=t.getDay()&&($("<div>",{id:"mensaTileDate"+a+1,"class":"mensaTile next",html:"nächster Tag"}).appendTo("#mensa"),$("#mensaTileDate"+a+1).click(function(){$("#mensaTileDate"+a+1).remove(),drawMensaMenu(e,new Date(t.setDate(t.getDate()+1)))}))};$("#menu").click(function(){$("div.header").toggleClass("dropdown")}),$("#menuNews").click(function(){$("div.header").toggleClass("dropdown"),$("html, body").animate({scrollLeft:$("#news").offset().left},200)}),$("#menuAgenda").click(function(){$("div.header").toggleClass("dropdown"),$("html, body").animate({scrollLeft:$("#agenda").offset().left},200)}),$("#menuMensa").click(function(){$("div.header").toggleClass("dropdown"),$("html, body").animate({scrollLeft:$("#mensa").offset().left},200)}),$("#menuContacts").click(function(){$("div.header").toggleClass("dropdown"),$("html, body").animate({scrollLeft:$("#contacts").offset().left},200)}),$("#menuTram").click(function(){$("div.header").toggleClass("dropdown"),$("html, body").animate({scrollLeft:$("#tram").offset().left},200)}),$(window).on("touchstop",function(e){e.stopImmediatePropagation()}),$("#info").click(function(){$("#home").toggleClass("popup"),$("#popupInfo").toggleClass("popup")}),$("#popupInfo").click(function(){$("#home").toggleClass("popup"),$("#popupInfo").toggleClass("popup")});