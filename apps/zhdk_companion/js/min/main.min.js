function debounce(e,t,n){var o;return function(){var a=this,i=arguments,d=function(){o=null,n||e.apply(a,i)},r=n&&!o;clearTimeout(o),o=setTimeout(d,t),r&&e.apply(a,i)}}$(document).ready(function(){function e(){Math.abs(s.x-m.x)>10&&Math.abs(s.y-m.y)<50&&(v||c.animate({scrollLeft:u+1.4*(m.x-s.x)},10))}function t(e,t){var n;return 0!=e.events[t].enddatum?($("#agendaTile"+t).addClass("eventOverTime"),n=moment(1e3*e.events[t].startdatum).format("Do MMM YYYY")+" - "+moment(1e3*e.events[t].enddatum).format("Do MMM YYYY")):n=0!=e.events[t].endzeit?moment(1e3*e.events[t].startzeit).format("HH:mm")+" - "+moment(1e3*e.events[t].endzeit).format("HH:mm")+" Uhr":moment(1e3*e.events[t].startzeit).format("HH:mm")+" Uhr",n}function n(e,t){var n;return 0!=e.events[t].enddatum?($("#agendaTile"+t).addClass("eventOverTime"),n=moment(1e3*e.events[t].startdatum).format("Do MMM YYYY")+" - "+moment(1e3*e.events[t].enddatum).format("Do MMM YYYY")):n=0!=e.events[t].endzeit?moment(1e3*e.events[t].startdatum).format("Do MMM YYYY")+", "+moment(1e3*e.events[t].startzeit).format("HH:mm")+" - "+moment(1e3*e.events[t].endzeit).format("HH:mm")+" Uhr":moment(1e3*e.events[t].startdatum).format("Do MMM YYYY")+", "+moment(1e3*e.events[t].startzeit).format("HH:mm")+" Uhr",n}var o=document.getElementById("body"),a=getEmPixels(o),i=getEmPixels(),d=(o.clientWidth/a,o.clientWidth/i,new Date(moment().valueOf())),r=moment(),l=moment().add(1,"d"),m={x:0,y:0},s={x:0,y:0},c=$("#pagesWrapper"),g=$("#mensa"),u=0,h="mensa",p=$("#menu"),f=$(window).width(),v=!1,Y=0,T=0,M=0,y=0;$(window).on("orientationchange",function(){location.reload()}),Date.prototype.getWeek=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil(((this-e)/864e5+e.getDay()+1)/7)},moment.locale("de");c.on("touchstart",function(e){v=!1,m.x=e.originalEvent.changedTouches[0].clientX,m.y=e.originalEvent.changedTouches[0].clientY,u=c.scrollLeft()}),c.on("touchmove",function(t){s.x=t.originalEvent.changedTouches[0].clientX,s.y=t.originalEvent.changedTouches[0].clientY,debounce(e(),16,!1)}),c.on("touchend",function(){v=!0,D()});var D=function(){u=c.scrollLeft(),.5>=u/f?(c.animate({scrollLeft:0},140),h="mensa"):u/f>.5&&1.5>=u/f?(c.animate({scrollLeft:f},140),h="agenda"):u/f>1.5&&2.5>=u/f&&(c.animate({scrollLeft:2*f},140),h="tram"),p.html(h)};$("#mensaLoadingImg").velocity({rotateZ:"360deg"},{loop:!0}),$.get("http://www.corsproxy.com/zfv.ch/de/microsites/gastronomie-im-toni-areal/menueplan",function(e){var t=$(e);$("#mensaLoading").toggle(!1),6==d.getDay()&&(d=new Date(moment().valueOf()+1728e5)),0==d.getDay()&&(d=new Date(moment().valueOf()+864e5)),b(t,d)});var b=function(e,t){var n=t.getWeek(),o=t.getDay(),i=-5*a;$("#mensa div").each(function(){i=i+$(this).height()+1.44*a}),$("<div>",{id:"mensaTileDate"+o,"class":"mensaTileDate roboto",html:moment(t).format("dddd, Do MMM YYYY")}).appendTo("#mensa"),moment(t).format("YYYY-MM-D")==r.format("YYYY-MM-D")&&$("#mensaTileDate"+o).html(moment(t).format("[Heute,] Do MMM YYYY")),moment(t).format("YYYY-MM-D")==l.format("YYYY-MM-D")&&$("#mensaTileDate"+o).html(moment(t).format("[Morgen,] Do MMM YYYY")),e.find("tbody tr").each(function(e){if($(this).data("dayofweek")==o&&$(this).data("weeknumber")==n){var t=$(this).find(":nth-child(1)"),a=$(this).find(":nth-child(2)");$("<div>",{id:"mensaTile"+e,"class":"mensaTile"}).appendTo("#mensa"),$("<span>",{html:t}).appendTo("#mensaTile"+e),$("<p>",{html:a}).appendTo("#mensaTile"+e),$("#mensaMenu").toggle(!0),$("#mensaMenu tr").toggle(!0),$("#mensaTile"+e+" p br:last-child").remove()}}),5!=t.getDay()&&$("<div>",{id:"mensaTileDate"+o+1,"class":"mensaTile next",html:"nÃ¤chster Tag"}).appendTo("#mensa"),g.animate({scrollTop:i},600),Y=0,$(".mensaTile").each(function(){$(this).is(":visible")||(Y++,$(this).delay(100*Y).velocity("transition.flipYIn",200))}),$("#mensaTileDate"+o+1).click(function(){$("#mensaTileDate"+o+1).remove(),b(e,new Date(moment(t).valueOf()+864e5))})};$("#agendaLoadingImg").velocity({rotateZ:"360deg"},{loop:!0});var L=moment(r).format("YYYY-MM-D"),w=moment(r).add(4,"M").format("YYYY-MM-D");$.getJSON("http://www.zhdk.ch/?agenda/feed&mindate="+L+"&maxdate="+w+"&format=json",null,function(e){x(e,0,24),$("#agendaLoading").toggle(!1)});var x=function(e,o,a){for(indexLoad=o;a>=indexLoad;++indexLoad){var i=t(e,indexLoad);M=1e3*e.events[indexLoad].startdatum;var d=new Date(M);M!=y&&0==e.events[indexLoad].enddatum&&($("<div>",{id:"agendaTileDate"+M,"class":"agendaTile agendaTileDate roboto",html:moment(d).format("dddd, Do MMM YYYY")}).appendTo("#agenda"),moment(d).format("YYYY-MM-D")==r.format("YYYY-MM-D")&&$("#agendaTileDate"+M).html(moment(d).format("[Heute,] Do MMM YYYY")),moment(d).format("YYYY-MM-D")==l.format("YYYY-MM-D")&&$("#agendaTileDate"+M).html(moment(d).format("[Morgen,] Do MMM YYYY"))),y=M,$("<div>",{id:"agendaTile"+indexLoad,"class":"agendaTile"}).appendTo("#agenda").click(function(t){$("#popupEvent").toggleClass("popup"),$("#popupBg").velocity("fadeIn",{duration:400});var o=t.currentTarget.id.replace("agendaTile","");if($("<span>",{html:e.events[o].titel}).appendTo("#eventContainer"),$("<span>",{html:n(e,o)}).appendTo("#eventContainer"),$("<span>",{html:"Veranstaltungsort: "+e.events[o].loc_shortname}).appendTo("#eventContainer"),$("<p>",{html:e.events[o].beschreibung}).appendTo("#eventContainer"),$("#popupEvent").css("background-image","none"),void 0!=e.events[o].files_info_img&&void 0!=e.events[o].files_info_img[0].thumb_ext_url){var a=e.events[o].files_info_img[0].thumb_ext_url;$("#popupEvent").css({"background-image":"url("+a+")","background-size":"auto "+2*f});var i=e.events[o].files_info_img[0].img_ext_url;$("<img>",{id:"eventImgLoader"}).appendTo("#eventContainer"),$("#eventImgLoader").queue(function(){$(this).delay(400)}).attr("src",i).load(function(){$(this).remove(),$("#popupEvent").css("background-image","url("+i+")")})}}),i=t(e,indexLoad),$("<span>",{html:e.events[indexLoad].titel}).appendTo("#agendaTile"+indexLoad),$("<p>",{html:e.events[indexLoad].kurzbeschreibung}).appendTo("#agendaTile"+indexLoad),$("<span>",{html:i,"class":"eventDateAndTime"}).appendTo("#agendaTile"+indexLoad)}$("<div>",{"class":"agendaTileLoadMore agendaTile",html:"Lade weitere"}).appendTo("#agenda").click(function(){x(e,a+1,a+25),$(".agendaTileLoadMore").toggle(!1)}),T=0,$(".agendaTile").each(function(){$(this).is(":visible")||$(this).hasClass("eventOverTime")||(T++,$(this).delay(100*T).velocity("transition.flipYIn",200))})};$("#tramLoadingImg0").velocity({rotateZ:"360deg"},{loop:!0}),$("#tramLoadingImg1").velocity({rotateZ:"360deg"},{loop:!0}),$("#tramLoadingImg2").velocity({rotateZ:"360deg"},{loop:!0}),$("#tramLoadingImg3").velocity({rotateZ:"360deg"},{loop:!0}),$.get("http://transport.opendata.ch/v1/connections?from=008591398&to=008503001",function(e){k($(e)),$("#tramLoading0").toggle(!1)}),$.get("http://transport.opendata.ch/v1/connections?from=008591398&to=008576182",function(e){C($(e)),$("#tramLoading1").toggle(!1)}),$.get("http://transport.opendata.ch/v1/connections?from=008591135&to=008591428",function(e){z($(e)),$("#tramLoading2").toggle(!1)}),$.get("http://transport.opendata.ch/v1/connections?from=008591135&to=008580522",function(e){H($(e)),$("#tramLoading3").toggle(!1)});var k=function(e){$.each(e.get(0).connections,function(t){var n=new Date(1e3*e.get(0).connections[t].from.departureTimestamp),o="0"+n.getHours(),a="0"+n.getMinutes(),i=o.substr(o.length-2)+":"+a.substr(a.length-2),d=e.get(0).connections[t].products[0];$("#toAltstetten"+t+" td:nth-child(2)").html(d),$("#toAltstetten"+t+" td:nth-child(3)").html("4"),$("#toAltstetten"+t+" td:nth-child(1)").html(i),$("#toAltstettenTile tr").css({"border-bottom":"1px solid #d4d4cc"})})},C=function(e){$.each(e.get(0).connections,function(t){var n=new Date(1e3*e.get(0).connections[t].from.departureTimestamp),o="0"+n.getHours(),a="0"+n.getMinutes(),i=o.substr(o.length-2)+":"+a.substr(a.length-2),d=e.get(0).connections[t].products[0];$("#toTiefenbrunnen"+t+" td:nth-child(2)").html(d),$("#toTiefenbrunnen"+t+" td:nth-child(3)").html("4"),$("#toTiefenbrunnen"+t+" td:nth-child(1)").html(i),$("#toTiefenbrunnenTile tr").css({"border-bottom":"1px solid #d4d4cc"})})},z=function(e){$.each(e.get(0).connections,function(t){var n=new Date(1e3*e.get(0).connections[t].from.departureTimestamp),o="0"+n.getHours(),a="0"+n.getMinutes(),i=o.substr(o.length-2)+":"+a.substr(a.length-2),d=e.get(0).connections[t].products[0];$("#toWerdhoelzli"+t+" td:nth-child(2)").html(d),$("#toWerdhoelzli"+t+" td:nth-child(3)").html("17"),$("#toWerdhoelzli"+t+" td:nth-child(1)").html(i),$("#toWerdhoelzliTile tr").css({"border-bottom":"1px solid #d4d4cc"})})},H=function(e){$.each(e.get(0).connections,function(t){var n=new Date(1e3*e.get(0).connections[t].from.departureTimestamp),o="0"+n.getHours(),a="0"+n.getMinutes(),i=o.substr(o.length-2)+":"+a.substr(a.length-2),d=e.get(0).connections[t].products[0];$("#toEscherWyssPlatz"+t+" td:nth-child(2)").html(d),$("#toEscherWyssPlatz"+t+" td:nth-child(3)").html("17"),$("#toEscherWyssPlatz"+t+" td:nth-child(1)").html(i),$("#toEscherWyssPlatzTile tr").css({"border-bottom":"1px solid #d4d4cc"})})},I=$("#hamburger");$("#menu").click(function(){I.hasClass("dropdown")?(I.velocity({duration:250,rotateZ:"0deg"}),$("div.header").velocity({height:"4em",duration:250})):(I.velocity({duration:250,rotateZ:"180deg"}),$("div.header").velocity({height:"14em",duration:250})),I.toggleClass("dropdown")}),I.click(function(){I.hasClass("dropdown")?(I.velocity({duration:250,rotateZ:"0deg"}),$("div.header").velocity({height:"4em",duration:250})):(I.velocity({duration:250,rotateZ:"180deg"}),$("div.header").velocity({height:"14em",duration:250})),I.toggleClass("dropdown")}),$("#menuMensa").click(function(){$("div.header").velocity({height:"4em",duration:250}),c.animate({scrollLeft:0},400),p.html("mensa"),I.velocity({duration:250,rotateZ:"0deg"}),I.toggleClass("dropdown")}),$("#menuAgenda").click(function(){$("div.header").velocity({height:"4em",duration:250}),c.animate({scrollLeft:f},400),p.html("agenda"),I.velocity({duration:250,rotateZ:"0deg"}),I.toggleClass("dropdown")}),$("#menuTram").click(function(){$("div.header").velocity({height:"4em",duration:250}),c.animate({scrollLeft:2*f},400),p.html("tram"),I.velocity({duration:250,rotateZ:"0deg"}),I.toggleClass("dropdown")}),$("#refresh").click(function(){location.reload(!0),$("#refresh").velocity({rotateZ:"1800deg"},{duration:5e3})}),$("#mensaLoadingTile").click(function(){location.reload(!0)}),$("#agendaLoadingTile").click(function(){location.reload(!0)}),$("#info").click(function(){$("#popupInfo").toggleClass("popup"),$("#popupBg").velocity("fadeIn",{duration:400})}),$("#popupInfo").click(function(){$("#popupInfo").toggleClass("popup"),$("#popupBg").velocity("fadeOut",{duration:400})}),$("#popupEvent").click(function(){$("#popupEvent").toggleClass("popup"),$("#popupBg").velocity("fadeOut",{duration:400}),$("#eventContainer").empty()}),$(window).on("navigate",function(e,t){var n=t.state.direction;"back"==n&&$("#popupInfo").hasClass("popup")&&(e.preventDefault(),$("#popupInfo").toggleClass("popup"),$("#popupBg").velocity("fadeOut",{duration:400}))})});