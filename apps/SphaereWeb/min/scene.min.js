function getWeatherHistory(){$.get("http://api.openweathermap.org/data/2.5/history/city?id=6295503&type=hour",function(e){for(var t=0;t<e.list.length;t++)weather.push({clouds:e.list[t].clouds.all,id:e.list[t].weather[0].id,date:1e3*e.list[t].dt});getWeatherCurrent()})}function getWeatherCurrent(){$.get("http://api.openweathermap.org/data/2.5/weather?id=6295503",function(e){srt=new Date(1e3*e.sys.sunrise),sunrise=srt.getHours()+srt.getMinutes()/60+srt.getSeconds()/60/60+srt.getMilliseconds()/60/60/1e3,sst=new Date(1e3*e.sys.sunset),sunset=sst.getHours()+sst.getMinutes()/60+sst.getSeconds()/60/60+sst.getMilliseconds()/60/60/1e3,weather.push({clouds:e.clouds.all,id:e.weather[0].id,date:1e3*e.dt}),getWeatherForeCast()})}function getWeatherForeCast(){$.get("http://api.openweathermap.org/data/2.5/forecast?id=6295503",function(e){for(var t=0;t<e.list.length;t++)weather.push({clouds:e.list[t].clouds.all,id:e.list[t].weather[0].id,date:1e3*e.list[t].dt});init(),initScene(),animate()})}function init(){var e;e=document.createElement("div"),document.body.appendChild(e),camera=new THREE.OrthographicCamera(window.innerWidth*-camZoom,window.innerWidth*camZoom,window.innerHeight*camZoom,window.innerHeight*-camZoom,.01,4e3),camera.position.set(camPosition[0],camPosition[1],camPosition[2]),camera.lookAt(new THREE.Vector3(0,0,0)),cameraOrtho=new THREE.OrthographicCamera(-window.innerWidth/2,window.innerWidth/2,window.innerHeight/2,-window.innerHeight/2,.1,100),cameraOrtho.position.z=10,scene=new THREE.Scene,sceneOrtho=new THREE.Scene,group=new THREE.Object3D,barGroup=new THREE.Object3D,tramMinutes=new THREE.Object3D,renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setSize(2*window.innerWidth,2*window.innerHeight),renderer.autoClear=!1,e.appendChild(renderer.domElement),$("canvas").css({width:window.innerWidth+"px",height:window.innerHeight+"px"}),online?$("body").append("<div id='time'>12:30</time>"):$("body").append("<div id='time'>no network connection</br>tap to retry</time>"),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.addEventListener("touchstart",rotateStart,!1),document.addEventListener("touchmove",rotate,!1),document.addEventListener("touchend",rotateFinish,!1),window.addEventListener("resize",onWindowResize,!1),window.addEventListener("orientationchange",function(){camZoom*=window.innerWidth/window.innerHeight,camera.left=window.innerWidth*-camZoom,camera.right=window.innerWidth*camZoom,camera.top=window.innerHeight*camZoom,camera.bottom=window.innerHeight*-camZoom,camera.updateProjectionMatrix(),cameraOrtho.left=-window.innerWidth/2,cameraOrtho.right=window.innerWidth/2,cameraOrtho.top=window.innerHeight/2,cameraOrtho.bottom=-window.innerHeight/2,cameraOrtho.updateProjectionMatrix()},!1),document.addEventListener("gesturechange",zoom,!1),document.addEventListener("gestureend",zoomFinish,!1),calculateDropPositions(),renderer.setClearColor(new THREE.Color(.95,.95,.95),0)}function initScene(){var e=new THREE.Geometry,t=new THREE.Vector3(0,0,.6),n=new THREE.Vector3(0,1,0),i=new THREE.Vector3(0,1,.1),a=new THREE.Vector3(0,0,.5);e.vertices.push(t,n,i,a),e.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(1,0,3));for(var r=0;90>r;r++){var o=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:lightColor,transparent:!1,opacity:0})),s=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:darkColor,transparent:!1,opacity:0}));o.rotation.z=Math.PI/2,o.position.x=-9.6,o.position.z=-8.6+.6*r,s.rotation.z=Math.PI/2,s.position.x=37.5,s.position.z=-8.6+.6*r,objects.departures.toniB.push(o),objects.departures.fischerwegB.push(s),tramMinutes.add(objects.departures.toniB[r],objects.departures.fischerwegB[r])}for(var r=0;60>r;r++){var h=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:lightColor,transparent:!1,opacity:0})),d=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:darkColor,transparent:!1,opacity:0}));h.rotation.z=Math.PI/2,h.position.x=-11.6,h.position.z=-9.5-.6*r,d.rotation.z=Math.PI/2,d.position.x=35.5,d.position.z=-9.5-.6*r,objects.departures.toniA.push(h),objects.departures.fischerwegA.push(d),tramMinutes.add(objects.departures.toniA[r],objects.departures.fischerwegA[r])}var c=50,w=64,m=new THREE.CircleGeometry(c,w);objects.ground=new THREE.Mesh(m,materialBack),objects.ground.rotation.x=-Math.PI/2;var u=new THREE.BoxGeometry(17,4,9);objects.toni.push(new THREE.Mesh(u,materialToni)),objects.toni[0].position.y=2;var l=new THREE.BoxGeometry(1,30,1);redBar=new THREE.Mesh(l,new THREE.MeshBasicMaterial({color:16711680})),redBar.position.y=-window.innerHeight/2+15;var g=new THREE.Geometry,p=new THREE.Vector3(0,0,0),E=new THREE.Vector3(-20,20,0),T=new THREE.Vector3(-20,-20,0);g.vertices.push(p,E,T),g.faces.push(new THREE.Face3(0,1,2)),triangle=new THREE.Mesh(new THREE.BoxGeometry(10,10,2),materialToni),triangle.rotation.z=.25*Math.PI,triangle.position.y=-window.innerHeight/2;var y=new THREE.BoxGeometry(.08,.1,90),f=new THREE.Mesh(y,materialToni),v=new THREE.Mesh(y,materialToni);f.position.x=-11.1,v.position.x=36,online&&group.add(f,v);var H=new THREE.BoxGeometry(1,10,1),b=new THREE.BoxGeometry(1,2,1);barGroupOffset=map(time%36e5,0,36e5,barSpace,0);for(var r=0;32>r;r++){var C=new THREE.Mesh(H,materialToni);C.position.y=-window.innerHeight/2+2.5,C.position.x=-(r-16)*barSpace+barGroupOffset;var R=new THREE.Mesh(b,materialToni);R.position.y=-window.innerHeight/2+1,R.position.x=-(r-16)*barSpace+barSpace/4+barGroupOffset;var M=new THREE.Mesh(b,materialToni);M.position.y=-window.innerHeight/2+1,M.position.x=-(r-16)*barSpace+barSpace/2+barGroupOffset;var z=new THREE.Mesh(b,materialToni);z.position.y=-window.innerHeight/2+1,z.position.x=-(r-16)*barSpace+.75*barSpace+barGroupOffset,barGroup.add(C,R,M,z)}objects.toni.push(new THREE.Mesh(new THREE.BoxGeometry(4,6,9),materialToni)),objects.toni[1].position.y=7,objects.toni[1].position.x=-6.5,group.add(objects.toni[0],objects.toni[1]);var D=new THREE.Geometry,W=new THREE.Vector3(0,0,5.6),j=new THREE.Vector3(0,1,0),x=new THREE.Vector3(0,1,5.1),O=new THREE.Vector3(0,0,.5);D.vertices.push(W,j,x,O),D.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(1,0,3)),objects.tramTA=new THREE.Mesh(D,materialToni),objects.tramTA.position.x=-11.6,objects.tramTA.position.z=-50,objects.tramTA.rotation.z=Math.PI/2,group.add(objects.tramTA);var I=THREE.ImageUtils.loadTexture("gradient.png"),N=new THREE.MeshBasicMaterial({color:0,map:I,transparent:!0}),A=new THREE.PlaneGeometry(100,100);gradient=new THREE.Mesh(A,N),gradient.rotation.x=-Math.PI/2,gradient.position.y=.1,online&&group.add(gradient);for(var r=0;r<restaurants.length;r++){restaurants[r];var B=new THREE.BoxGeometry(restaurants[r].size[0],restaurants[r].size[1],.5),P=new THREE.Mesh(B,new THREE.MeshBasicMaterial({color:darkColor}));restaurantsObj.push(P),P.rotation.x=-Math.PI/2,P.position.x=restaurants[r].position[0],P.position.z=restaurants[r].position[1],P.position.y=.25,group.add(restaurantsObj[r])}online&&group.add(tramMinutes),scene.add(group),sceneOrtho.add(barGroup,triangle),resetView()}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onDocumentMouseMove(){}function createText(){}function createTextWoPositioning(){}function rotateStart(e){if(e.preventDefault(),!(e.touches.length>1)){var t=(new Date).getTime(),n=t-mylatesttap;if(350>n&&n>0)return resettingView=!0,resetView(),void 0;mylatesttap=(new Date).getTime(),e.touches[0].clientY>window.innerHeight-48&&(settingTime=!0,$("#time").addClass("active"),online||location.reload()),touchstart.x=e.touches[0].clientX,touchstart.y=e.touches[0].clientY}}function rotate(e){if(e.preventDefault(),e.touches.length>1)for(var t=0;t<e.touches.length;t++)multiTouches[multiTouchId]=e.touches[t].identifier,multiTouchId++,multiTouchId%=5;else{for(var t=multiTouches.length-1;t>=0;t--)if(multiTouches[t]==e.touches[0].identifier)return;if(settingTime)return setTime(e),void 0;if(!resettingView){var n=rotation.z-.2*(touchstart.y-e.touches[0].clientY);n>100&&(n=100),0>n&&(n=0),new TWEEN.Tween({c:camera.position.y,ry:group.rotation.y}).to({c:n,ry:rotation.y+(touchstart.x-e.touches[0].clientX)*-.01},50).easing(TWEEN.Easing.Linear.None).onUpdate(function(){camera.position.setY(this.c),camera.position.setX(100-this.c),camera.lookAt(new THREE.Vector3(0,0,0)),group.rotation.y=this.ry}).start()}}}function rotateFinish(e){if(e.preventDefault(),!(e.touches.length>1)){for(var t=multiTouches.length-1;t>=0;t--)if(multiTouches[t]==e.changedTouches[0].identifier)return;if(settingTime)return finishTime(e),settingTime=!1,$("#time").removeClass("active"),sceneOrtho.remove(objects.time),stringTime="",void 0;if(!resettingView){var n=rotation.z-.2*(touchstart.y-e.changedTouches[0].clientY);n>100&&(n=100),0>n&&(n=0),new TWEEN.Tween({c:camera.position.y,ry:group.rotation.y}).to({c:n,ry:rotation.y+(touchstart.x-e.changedTouches[0].clientX)*-.01},400).easing(TWEEN.Easing.Quartic.Out).onUpdate(function(){camera.position.setY(this.c),camera.position.setX(100-this.c),camera.lookAt(new THREE.Vector3(0,0,0)),group.rotation.y=this.ry,rotation.y=this.ry,rotation.z=this.c}).onComplete(function(){rotation.y=this.ry,rotation.z=this.c}).start()}}}function zoom(e){e.preventDefault();var t=window.innerWidth*-camZoom*(1/e.scale),n=window.innerHeight*camZoom*(1/e.scale);-50>t&&(t=-50,n=-t*(window.innerHeight/window.innerWidth)),t>-15&&(t=-15,n=-t*(window.innerHeight/window.innerWidth)),new TWEEN.Tween({l:camera.left,r:camera.right,t:camera.top,b:camera.bottom}).to({l:t,r:-t,t:n,b:-n},50).easing(TWEEN.Easing.Linear.None).onUpdate(function(){camera.left=this.l,camera.right=this.r,camera.top=this.t,camera.bottom=this.b,camera.updateProjectionMatrix()}).start()}function zoomFinish(e){var t=window.innerWidth*-camZoom*(1/e.scale),n=window.innerHeight*camZoom*(1/e.scale);-50>t&&(t=-50,n=-t*(window.innerHeight/window.innerWidth)),t>-15&&(t=-15,n=-t*(window.innerHeight/window.innerWidth)),new TWEEN.Tween({l:camera.left,r:camera.right,t:camera.top,b:camera.bottom}).to({l:t,r:-t,t:n,b:-n},400).easing(TWEEN.Easing.Quartic.Out).onUpdate(function(){camera.left=this.l,camera.right=this.r,camera.top=this.t,camera.bottom=this.b,camera.updateProjectionMatrix()}).onComplete(function(){camZoom=-t/window.innerWidth}).start()}function setTime(e){time+=2e4*(touchstart.x-e.touches[0].clientX),touchstart.x=e.touches[0].clientX}function finishTime(){}function updateDay(){(new Date).getTime()>launchTime+36e5&&location.reload(),time>launchTime+432e5&&(time=launchTime+432e5),launchTime-432e5>time&&(time=launchTime-432e5);var e=(new Date).getTime();if(lastDateTimed){time+=e-lastDateTimed;var t=e-lastDateTimed;t>50&&(t=50);for(var n=0;t>n;n++)Math.random()<rainChance&&createDrop();for(var n=0;t>n;n+=3)Math.random()<snowChance&&createFlake()}barGroup.position.x=map((launchTime-time)%36e5,0,36e5,0,barSpace);var i=new Date(time).getHours()+"";10>i?i="0"+i+":":i+=":";var a=new Date(time).getMinutes()+"";10>a?i=i+"0"+a:i+=a;var r=new Date(time),o=r.getHours()+r.getMinutes()/60+r.getSeconds()/60/60+r.getMilliseconds()/60/60/1e3;dayLight=Math.abs(o-12);for(var n=0;n<weather.length;n++)if(weather[n].date>time){if(isDay)var s=map(time,weather[n-1].date,weather[n].date,weatherCodes[weather[n-1].id].day[0],weatherCodes[weather[n].id].day[0]),h=map(time,weather[n-1].date,weather[n].date,weatherCodes[weather[n-1].id].day[1],weatherCodes[weather[n].id].day[1]),d=map(time,weather[n-1].date,weather[n].date,weatherCodes[weather[n-1].id].day[2],weatherCodes[weather[n].id].day[2]);else var s=map(time,weather[n-1].date,weather[n].date,weatherCodes[weather[n-1].id].night[0],weatherCodes[weather[n].id].night[0]),h=map(time,weather[n-1].date,weather[n].date,weatherCodes[weather[n-1].id].night[1],weatherCodes[weather[n].id].night[1]),d=map(time,weather[n-1].date,weather[n].date,weatherCodes[weather[n-1].id].night[2],weatherCodes[weather[n].id].night[2]);clearColor=new THREE.Color(s/255,h/255,d/255),new TWEEN.Tween({r:renderer.getClearColor().r,g:renderer.getClearColor().g,b:renderer.getClearColor().b}).to({r:s/255,g:h/255,b:d/255},400).easing(TWEEN.Easing.Quartic.Out).onUpdate(function(){renderer.setClearColor(new THREE.Color(this.r,this.g,this.b),0),gradient.material.color.set(new THREE.Color(this.r,this.g,this.b),0)}).onComplete(function(){renderer.setClearColor(new THREE.Color(this.r,this.g,this.b),0),gradient.material.color.set(new THREE.Color(this.r,this.g,this.b),0)}).start(),rainChance=map(time,weather[n-1].date,weather[n].date,weatherCodes[weather[n-1].id].rain,weatherCodes[weather[n].id].rain),snowChance=map(time,weather[n-1].date,weather[n].date,weatherCodes[weather[n-1].id].snow,weatherCodes[weather[n].id].snow);break}if(o>sunrise&&sunrise>=lastTimeInHours&&sunset>o||sunset>o&&lastTimeInHours>=sunset&&o>sunrise||sunset>o&&o>sunrise&&-1==lastTimeInHours){for(var n=0;n<tramMinutes.children.length;n++)tweenDepartureColor(tramMinutes.children[n],darkColor);isDay=!0,$("#time").removeClass("night"),new TWEEN.Tween({t:.95,g:.15}).to({t:.15,g:.95},1e3).easing(TWEEN.Easing.Quartic.Out).onUpdate(function(){objects.toni[0].material.color.set(new THREE.Color(this.t,this.t,this.t)),objects.ground.material.color.set(new THREE.Color(this.g,this.g,this.g))}).onComplete(function(){objects.toni[0].material.color.set(new THREE.Color(.15,.15,.15)),objects.ground.material.color.set(new THREE.Color(.95,.95,.95))}).start()}if(sunrise>o&&lastTimeInHours>=sunrise&&sunset>=lastTimeInHours||o>sunset&&sunset>=lastTimeInHours&&lastTimeInHours>=sunrise||(o>=sunset||sunrise>=o)&&-1==lastTimeInHours){isDay=!1;for(var n=0;n<tramMinutes.children.length;n++)tweenDepartureColor(tramMinutes.children[n],lightColor);$("#time").addClass("night"),new TWEEN.Tween({t:.15,g:.95}).to({t:.95,g:.15},1e3).easing(TWEEN.Easing.Quartic.Out).onUpdate(function(){objects.toni[0].material.color.set(new THREE.Color(this.t,this.t,this.t)),objects.ground.material.color.set(new THREE.Color(this.g,this.g,this.g))}).onComplete(function(){objects.toni[0].material.color.set(new THREE.Color(.95,.95,.95)),objects.ground.material.color.set(new THREE.Color(.15,.15,.15))}).start()}for(var n=0;n<restaurants.length;n++){for(var c=new Date(time).getDay(),w=!1,m=0;m<restaurants[n].open[c].length;m++){var u=restaurants[n].open[c][m];o>u[0]&&o<u[1]&&(w=!0)}w?tweenRestaurantOpacity(restaurantsObj[n],1):tweenRestaurantOpacity(restaurantsObj[n],0)}(stringTime!=i||isDay!=lastIsDay)&&(updateDepartures(),stringTime=""==stringTime?"...":i,$("#time").text(i)),lastIsDay=isDay,lastDayLight=dayLight,lastTimeInHours=o,lastDateTimed=e}function updateDepartures(){for(var e=connectionAtCurrentTimeT-5;e<zvvData.toni.length;e++)if(zvvData.toni[e].toCity){var t=Math.floor((new Date(1e3*zvvData.toni[e].time).getTime()-time)/6e4);if(t>=0){for(var e=0;e<objects.departures.toniA.length;e++)t>e?tweenDepartureOpacity(objects.departures.toniA[e],1):tweenDepartureOpacity(objects.departures.toniA[e],0);lastDepartures.toniA=t;break}}for(var e=connectionAtCurrentTimeT-5;e<zvvData.toni.length;e++)if(!zvvData.toni[e].toCity){var t=Math.floor((new Date(1e3*zvvData.toni[e].time).getTime()-time)/6e4);if(t>=0){for(var e=0;e<objects.departures.toniB.length;e++)t>e?tweenDepartureOpacity(objects.departures.toniB[e],1):tweenDepartureOpacity(objects.departures.toniB[e],0);lastDepartures.toniB=t,connectionAtCurrentTimeT=e;break}}for(var e=connectionAtCurrentTimeF-5;e<zvvData.fischerweg.length;e++)if(zvvData.fischerweg[e].toCity){var t=Math.floor((new Date(1e3*zvvData.fischerweg[e].time).getTime()-time)/6e4);if(t>=0){for(var e=0;e<objects.departures.fischerwegA.length;e++)t>e?tweenDepartureOpacity(objects.departures.fischerwegA[e],1):tweenDepartureOpacity(objects.departures.fischerwegA[e],0);lastDepartures.fischerwegA=t;break}}for(var e=connectionAtCurrentTimeF-5;e<zvvData.fischerweg.length;e++)if(!zvvData.fischerweg[e].toCity){var t=Math.floor((new Date(1e3*zvvData.fischerweg[e].time).getTime()-time)/6e4);if(t>=0){for(var e=0;e<objects.departures.fischerwegB.length;e++)t>e?tweenDepartureOpacity(objects.departures.fischerwegB[e],1):tweenDepartureOpacity(objects.departures.fischerwegB[e],0);lastDepartures.fischerwegB=t,connectionAtCurrentTimeF=e;break}}}function animateTram(e){new TWEEN.Tween({t:-50}).to({t:-50},3e4).easing(TWEEN.Easing.Quartic.In).onUpdate(function(){e.position.z=this.t}).onComplete(function(){new TWEEN.Tween({t:-50}).to({t:-14.5},1e4).easing(TWEEN.Easing.Quartic.Out).onUpdate(function(){e.position.z=this.t}).onComplete(function(){new TWEEN.Tween({t:-14.5}).to({t:-14.5},15e3).easing(TWEEN.Easing.Quartic.In).onUpdate(function(){e.position.z=this.t}).onComplete(function(){new TWEEN.Tween({t:-14.5}).to({t:50},1e4).easing(TWEEN.Easing.Quartic.In).onUpdate(function(){e.position.z=this.t}).onComplete(function(){e.position.z=50}).start()}).start()}).start()}).start()}function tweenDepartureColor(e,t){new TWEEN.Tween({t:e.material.color.r}).to({t:t.r},400).easing(TWEEN.Easing.Quartic.Out).onUpdate(function(){e.material.color.set(new THREE.Color(this.t,this.t,this.t))}).onComplete(function(){e.material.color.set(t)}).start()}function tweenDepartureOpacity(e,t){if(t){var n=0;if(isDay)var i=darkColor;else var i=lightColor}else var i=clearColor,n=-1;new TWEEN.Tween({r:e.material.color.r,g:e.material.color.g,b:e.material.color.b,y:e.position.y}).to({r:i.r,g:i.g,b:i.b,y:n},400).easing(TWEEN.Easing.Quartic.Out).onUpdate(function(){e.material.color.set(new THREE.Color(this.r,this.g,this.b)),e.position.y=this.y}).onComplete(function(){e.material.color.set(i),e.position.y=n}).start()}function tweenRestaurantOpacity(e,t){if(t){var n=.25;if(isDay)var i=darkColor;else var i=lightColor}else var i=clearColor,n=-4;new TWEEN.Tween({r:e.material.color.r,g:e.material.color.g,b:e.material.color.b,y:e.position.y}).to({r:i.r,g:i.g,b:i.b,y:n},400).easing(TWEEN.Easing.Quartic.Out).onUpdate(function(){e.material.color.set(new THREE.Color(this.r,this.g,this.b)),e.position.y=this.y}).onComplete(function(){e.material.color.set(i),e.position.y=n}).start()}function resetView(){var e=window.innerWidth*-.072,t=.072*window.innerHeight;new TWEEN.Tween({t:time}).to({t:(new Date).getTime()},400).easing(TWEEN.Easing.Quartic.Out).onUpdate(function(){time=this.t}).start(),new TWEEN.Tween({l:camera.left,r:camera.right,t:camera.top,b:camera.bottom}).to({l:e,r:-e,t:t,b:-t},400).easing(TWEEN.Easing.Quartic.InOut).onUpdate(function(){camera.left=this.l,camera.right=this.r,camera.top=this.t,camera.bottom=this.b,camera.updateProjectionMatrix()}).onComplete(function(){camZoom=-e/window.innerWidth,$("#loading").css({opacity:0})}).start();if(group.rotation.y%(2*Math.PI)>=Math.PI)var n=2*Math.round(group.rotation.y/(2*Math.PI))*Math.PI-Math.PI;else var n=2*Math.round(group.rotation.y/(2*Math.PI))*Math.PI+Math.PI;new TWEEN.Tween({c:camera.position.y,ry:group.rotation.y}).to({c:100,ry:n},400).easing(TWEEN.Easing.Quartic.InOut).onUpdate(function(){camera.position.setY(this.c),camera.position.setX(100-this.c),camera.lookAt(new THREE.Vector3(0,0,0)),group.rotation.y=this.ry}).onComplete(function(){rotation.y=group.rotation.y,rotation.z=camera.position.y,resettingView=!1}).start()}function animate(e){requestAnimationFrame(animate),TWEEN.update(e),online&&updateDay(),render()}function render(){renderer.clear(),renderer.render(scene,camera),renderer.clearDepth(),online&&renderer.render(sceneOrtho,cameraOrtho)}function createDrop(){if(camera.position.y>90)var e=new THREE.Mesh(new THREE.BoxGeometry(.1,1+3*Math.random(),.1),materialToni);else var e=new THREE.Mesh(new THREE.BoxGeometry(.03,1+3*Math.random(),.03),materialToni);group.add(e),e.position.x=dropPositions[dropIndex][0],e.position.z=dropPositions[dropIndex][1],dropIndex++,dropIndex%=1e4,e.position.y=100,new TWEEN.Tween({y:e.position.y}).to({y:1.5},400+200*Math.random()).easing(TWEEN.Easing.Linear.None).onUpdate(function(){e.position.y=this.y}).onComplete(function(){group.remove(e)}).start()}function createFlake(){var e=new THREE.Mesh(new THREE.BoxGeometry(.1,.1,.1),materialToni);group.add(e),e.position.x=dropPositions[dropIndex][0],e.position.z=dropPositions[dropIndex][1],dropIndex++,dropIndex%=1e4,e.position.y=100,new TWEEN.Tween({y:e.position.y}).to({y:0},3e3).easing(TWEEN.Easing.Linear.None).onUpdate(function(){e.position.y=this.y}).onComplete(function(){group.remove(e)}).start()}function calculateDropPositions(){for(var e=0;1e4>e;e++){var t=100*Math.random()-50,n=100*Math.random()-50;t*t+n*n>2e3?e--:dropPositions.push([t,n])}}var mouseX=0,mouseY=0,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,SEPARATION=200,AMOUNTX=10,AMOUNTY=10,camPosition=[-50,100,0],camZoom=.07,zoomFactor=10,camLeft=window.innerWidth*camZoom,camTop=window.innerHeight*camZoom,camera,scene,renderer,controls,group,zvvData,cameraOrtho,sceneOrtho,barGroup,tramMinutes,triangle,redBar,gradient,scale=1,multiTouches=[0,0,0,0,0];multiTouchId=0,touchstart={x:0,y:0},rotation={y:0,z:100},sunrise=6,sunset=18,barGroupOffset=0,barSpace=150,weather=[],dropPositions=[],restaurantsObj=[],mylatesttap=0,dropIndex=0,rainChance=0,snowChance=0,launchTime=(new Date).getTime(),objects={ground:void 0,toni:[],tram1:void 0,tram2:void 0,time:void 0,departures:{toniA:[],toniB:[],fischerwegA:[],fischerwegB:[]},tramTA:void 0},lastDepartures={toniA:0,toniB:0},stringTime="",time=(new Date).getTime(),settingTime=!1,resettingView=!1,connectionAtCurrentTimeT=0,connectionAtCurrentTimeF=0,lastDateTimed=0,isDay=!0,lastIsDay=!1,dayLight=0,lastDayLight=0,lastTimeInHours=-1,materialToni=new THREE.MeshBasicMaterial({color:new THREE.Color(1,.15,.15)}),materialBack=new THREE.MeshBasicMaterial({color:16777215}),lightColor=new THREE.Color(.95,.95,.95),darkColor=new THREE.Color(.15,.15,.15),clearColor=new THREE.Color(.15,.15,.15),weatherCodes={200:{name:"thunderstorm with light rain",day:[159,166,174],night:[29,35,40],rain:.1,snow:0,thunder:0},201:{name:"thunderstorm with rain",day:[124,135,142],night:[33,35,36],rain:.4,snow:0,thunder:0},202:{name:"thunderstorm with heavy rain",day:[105,115,124],night:[28,28,29],rain:.8,snow:0,thunder:0},210:{name:"light thunderstorm",day:[188,188,186],night:[31,32,49],rain:.2,snow:0,thunder:0},211:{name:"thunderstorm",day:[150,152,156],night:[32,32,45],rain:.4,snow:0,thunder:0},212:{name:"heavy thunderstorm",day:[103,113,123],night:[34,34,44],rain:.6,snow:0,thunder:0},221:{name:"ragged thunderstorm",day:[84,99,112],night:[26,26,29],rain:.8,snow:0,thunder:0},230:{name:"thunderstorm with light drizzle",day:[185,185,185],night:[44,42,42],rain:.05,snow:0,thunder:0},231:{name:"thunderstorm with drizzle",day:[165,165,168],night:[31,29,29],rain:.1,snow:0,thunder:0},232:{name:"thunderstorm with heavy drizzle",day:[151,155,161],night:[18,17,17],rain:.2,snow:0,thunder:0},300:{name:"light intensity drizzle",day:[247,247,249],night:[22,22,24],rain:.05,snow:0,thunder:0},301:{name:"drizzle",day:[230,233,232],night:[29,32,31],rain:.1,snow:0,thunder:0},302:{name:"heavy intensity drizzle",day:[206,217,214],night:[35,40,39],rain:.3,snow:0,thunder:0},310:{name:"light intensity drizzle rain",day:[244,244,244],night:[28,26,26],rain:.1,snow:0,thunder:0},311:{name:"drizzle rain",day:[194,206,204],night:[36,39,39],rain:.3,snow:0,thunder:0},312:{name:"heavy intensity drizzle rain",day:[167,184,181],night:[31,34,33],rain:.5,snow:0,thunder:0},313:{name:"shower rain and drizzle",day:[198,210,206],night:[38,40,39],rain:.7,snow:0,thunder:0},314:{name:"heavy shower rain and drizzle",day:[152,175,171],night:[27,29,29],rain:1,snow:0,thunder:0},321:{name:"shower drizzle",day:[155,173,191],night:[25,27,29],rain:.6,snow:0,thunder:0},500:{name:"light rain",day:[211,224,241],night:[17,18,19],rain:.25,snow:0,thunder:0},501:{name:"moderate rain",day:[187,202,222],night:[22,23,26],rain:.4,snow:0,thunder:0},502:{name:"heavy intensity rain",day:[164,179,198],night:[28,31,34],rain:.6,snow:0,thunder:0},503:{name:"very heavy rain",day:[146,158,173],night:[34,37,40],rain:.8,snow:0,thunder:0},504:{name:"extreme rain",day:[137,148,161],night:[44,48,53],rain:1,snow:0,thunder:0},511:{name:"freezing rain",day:[200,206,214],night:[9,9,10],rain:.2,snow:.2,thunder:0},520:{name:"light intensity shower rain",day:[207,210,215],night:[29,30,31],rain:.4,snow:0,thunder:0},521:{name:"shower rain",day:[200,202,204],night:[38,40,42],rain:.6,snow:0,thunder:0},522:{name:"heavy intensity shower rain",day:[188,190,193],night:[36,37,38],rain:.8,snow:0,thunder:0},531:{name:"ragged shower rain",day:[178,178,179],night:[23,25,28],rain:1,snow:0,thunder:0},600:{name:"light snow",day:[247,247,247],night:[47,46,43],rain:0,snow:.2,thunder:0},601:{name:"snow",day:[235,235,235],night:[32,31,30],rain:0,snow:.5,thunder:0},602:{name:"heavy snow",day:[220,220,220],night:[30,29,25],rain:0,snow:1,thunder:0},611:{name:"sleet",day:[217,225,229],night:[39,42,43],rain:.3,snow:.3,thunder:0},612:{name:"shower sleet",day:[199,210,215],night:[26,29,30],rain:.6,snow:.5,thunder:0},615:{name:"light rain and snow",day:[221,224,226],night:[36,38,39],rain:.2,snow:.3,thunder:0},616:{name:"rain and snow",day:[203,204,205],night:[37,38,38],rain:.4,snow:.5,thunder:0},620:{name:"light shower snow",day:[247,247,247],night:[47,46,43],rain:0,snow:.6,thunder:0},621:{name:"shower snow",day:[235,235,235],night:[32,31,30],rain:0,snow:.8,thunder:0},622:{name:"heavy shower snow",day:[220,220,220],night:[30,29,25],rain:0,snow:.9,thunder:0},701:{name:"mist",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},711:{name:"smoke",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},721:{name:"haze",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},731:{name:"sand, dust whirls",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},741:{name:"fog",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},751:{name:"sand",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},761:{name:"dust",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},762:{name:"volcanic ash",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},771:{name:"squalls",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},781:{name:"tornado",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},800:{name:"clear sky",day:[82,197,252],night:[25,27,66],rain:0,snow:0,thunder:0},801:{name:"few clouds",day:[110,183,239],night:[27,28,56],rain:0,snow:0,thunder:0},802:{name:"scattered clouds",day:[146,196,234],night:[31,32,55],rain:0,snow:0,thunder:0},803:{name:"broken clouds",day:[163,196,222],night:[34,35,50],rain:0,snow:0,thunder:0},804:{name:"overcast clouds",day:[188,197,204],night:[28,29,34],rain:0,snow:0,thunder:0},900:{name:"tornado",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},901:{name:"tropical storm",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},902:{name:"hurricane",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},903:{name:"cold",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},904:{name:"hot",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},905:{name:"windy",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},906:{name:"hail",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},951:{name:"calm",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},952:{name:"light breeze",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},953:{name:"gentle breeze",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},954:{name:"moderate breeze",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},955:{name:"fresh breeze",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},956:{name:"strong breeze",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},957:{name:"high wind, near gale",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},958:{name:"gale",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},959:{name:"severe gale",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},960:{name:"storm",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},961:{name:"violent storm",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0},962:{name:"hurricane",day:[235,235,235],night:[28,29,34],rain:0,snow:0,thunder:0}},restaurants=[{name:"NUOVU",position:[-7,-12],size:[2,1.4],open:[[[11,12]],[[7,24]],[[0,1],[7,24]],[[0,1],[7,24]],[[0,1],[7,24]],[[0,1],[7,24]],[[0,1][12]]]},{name:"Route twenty-six",position:[-6.5,-14],size:[3,1.4],open:[[[6.5,14]],[[6.5,10],[11.5,14],[18.5,23]],[[6.5,10],[11.5,14],[18.5,23]],[[6.5,10],[11.5,14],[18.5,23]],[[6.5,10],[11.5,14],[18.5,23]],[[6.5,10],[11.5,14],[18.5,23]],[[6.5,14]]]},{name:"Migros Restaurant",position:[-19.5,-19.5],size:[6,4.3],open:[[],[[6.5,14]],[[6.5,14]],[[6.5,14]],[[6.5,14]],[[6.5,14]],[[6.5,12.25]]]},{name:"Migros",position:[-19.5,-24],size:[6,3.3],open:[[],[[8,18]],[[8,18]],[[8,18]],[[8,18]],[[8,18]],[[9,14]]]},{name:"Arno's Bistro",position:[-7,-20.2],size:[2,1.4],open:[[],[[11,14]],[[11,14]],[[11,14]],[[11,14]],[[11,14]],[]]},{name:"naanu",position:[-6.5,-22.5],size:[3,1.8],open:[[],[[9,17]],[[9,17]],[[9,17]],[[9,14.5],[17,22]],[[9,14.5],[17,22]],[]]},{name:"Läbis Grill",position:[-7,-24.7],size:[2,1.4],open:[[],[],[],[],[],[],[]]},{name:"Caffé Pascucci",position:[-4.3,-18.6],size:[1.4,2],open:[[],[[9,15]],[[9,15]],[[9,15]],[[9,23]],[[9,23]],[18,24]]},{name:"coppolini",position:[-2.4,-18.6],size:[1.4,2],open:[[],[[9,15]],[[9,15]],[[9,15]],[[9,23]],[[9,23]],[18,24]]},{name:"Neni",position:[-2.6,-21.6],size:[1.8,3],open:[[[7.5,23]],[[6.5,23]],[[6.5,23]],[[6.5,23]],[[6.5,23]],[[6.5,23]],[[7.5,23]]]}],online=!0,$(function(){$.get("http://toni.fidelthomet.com/data/json/data.json",function(e){zvvData=e[1];for(var t=0;t<zvvData.toni.length;t++)if(new Date(1e3*zvvData.toni[t].time).getTime()>=(new Date).getTime()){connectionAtCurrentTimeT=t;break}for(var t=0;t<zvvData.fischerweg.length;t++)if(new Date(1e3*zvvData.fischerweg[t].time).getTime()>=(new Date).getTime()){connectionAtCurrentTimeF=t;break}getWeatherHistory()}).fail(function(){online=!1,init(),initScene(),animate()})}),lerp=function(e,t,n){return(t-e)*n+e},map=function(e,t,n,i,a){return i+(a-i)*((e-t)/(n-t))};