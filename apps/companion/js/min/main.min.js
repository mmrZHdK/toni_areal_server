$(document).ready(function(){function e(e,t){var n;return 0!=e.events[t].enddatum?($("#agendaTile"+t).addClass("eventOverTime"),n=moment(1e3*e.events[t].startdatum).format("Do MMM YYYY")+" - "+moment(1e3*e.events[t].enddatum).format("Do MMM YYYY")):n=0!=e.events[t].endzeit?moment(1e3*e.events[t].startzeit).format("HH:mm")+" - "+moment(1e3*e.events[t].endzeit).format("HH:mm"):moment(1e3*e.events[t].startzeit).format("HH:mm"),n}function t(e,t){var n;return 0!=e.events[t].enddatum?($("#agendaTile"+t).addClass("eventOverTime"),n=moment(1e3*e.events[t].startdatum).format("Do MMM YYYY")+" - "+moment(1e3*e.events[t].enddatum).format("Do MMM YYYY")):n=0!=e.events[t].endzeit?moment(1e3*e.events[t].startdatum).format("Do MMM YYYY")+", "+moment(1e3*e.events[t].startzeit).format("HH:mm")+" - "+moment(1e3*e.events[t].endzeit).format("HH:mm"):moment(1e3*e.events[t].startdatum).format("Do MMM YYYY")+", "+moment(1e3*e.events[t].startzeit).format("HH:mm"),n}var n=$(".swiper-container").swiper({mode:"horizontal",loop:!1}),a=($("body"),getEmPixels(body)),o=getEmPixels(),i=(body.clientWidth/a,body.clientWidth/o,new Date(moment().valueOf())),d=moment(),s=moment().add(1,"d"),l=($("#pagesWrapper"),$("#mensa")),r=$("#menu"),m=$("#header"),g=$("#menuMensa"),c=$("#menuAgenda"),p=$("#menuTram"),u=($(window).width(),0),v=0,h=0,f=0,T=d;$.ajaxSetup({timeout:5e3}),Date.prototype.getWeek=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil(((this-e)/864e5+e.getDay()+1)/7)},moment.locale("de");n.wrapperTransitionEnd(function(){0==n.activeIndex?(menuChar="mensa",m.addClass("mensa"),m.removeClass("agenda"),m.removeClass("tram"),g.toggle(!1),c.toggle(!0),p.toggle(!0)):1==n.activeIndex?(menuChar="agenda",m.addClass("agenda"),m.removeClass("mensa"),m.removeClass("tram"),g.toggle(!0),c.toggle(!1),p.toggle(!0)):2==n.activeIndex&&(menuChar="tram",m.addClass("tram"),m.removeClass("mensa"),m.removeClass("agenda"),g.toggle(!0),c.toggle(!0),p.toggle(!1)),$("#menu").html(menuChar)},!0),$("#mensaLoadingImg").velocity({rotateZ:"360deg"},{loop:!0});var Y=0,M=function(){$.ajax({url:"http://www.corsproxy.com/zfv.ch/de/microsites/gastronomie-im-toni-areal/menueplan",success:function(e){var t=$(e);$("#mensaLoading img").velocity("stop"),$("#mensaLoading").toggle(!1),6==i.getDay()&&(i=new Date(moment().valueOf()+1728e5)),0==i.getDay()&&(i=new Date(moment().valueOf()+864e5)),y(t,i)},error:function(){console.log("could not get data"),5>Y?(Y++,M()):($("#mensaLoading img").velocity("stop"),$("#mensaLoading").toggle(!1),$("<div>",{"class":"mensaTileDate roboto",html:"Daten konnten nicht geladen werden. Es besteht m√∂glicherweise keine Verbindung zum Internet."}).appendTo("#mensa"))},timeout:4e3})};M();var y=function(e,t){var n=t.getWeek(),o=t.getDay(),i=-5*a;$("#mensa div").each(function(){i=i+$(this).height()+1.15*a}),$("<div>",{id:"mensaTileDate"+o,"class":"mensaTileDate roboto",html:moment(t).format("dddd, Do MMM YYYY")}).appendTo("#mensa"),moment(t).format("YYYY-MM-D")==d.format("YYYY-MM-D")&&$("#mensaTileDate"+o).html(moment(t).format("[Heute,] Do MMM YYYY")),moment(t).format("YYYY-MM-D")==s.format("YYYY-MM-D")&&$("#mensaTileDate"+o).html(moment(t).format("[Morgen,] Do MMM YYYY")),e.find("tbody tr").each(function(e){if($(this).data("dayofweek")==o&&$(this).data("weeknumber")==n){var t=$(this).find(":nth-child(1)"),a=$(this).find(":nth-child(2)");$("<div>",{id:"mensaTile"+e,"class":"mensaTile"}).appendTo("#mensa"),$("<span>",{html:t}).appendTo("#mensaTile"+e),$("<p>",{html:a}).appendTo("#mensaTile"+e),$("#mensaMenu").toggle(!0),$("#mensaMenu tr").toggle(!0),$("#mensaTile"+e+" p br:last-child").remove()}}),5!=t.getDay()&&($("<div>",{id:"mensaTileDate"+o+1,"class":"mensaTile next"}).appendTo("#mensa"),$("<img>",{src:"img/mensaNext.svg","class":"mensaNextIcon"}).appendTo("#mensaTileDate"+o+1)),l.animate({scrollTop:i},600),u=0,$(".mensaTile").each(function(){$(this).is(":visible")||(u++,$(this).delay(100*u).velocity("transition.flipYIn",200))}),$("#mensaTileDate"+o+1).click(function(){$("#mensaTileDate"+o+1).remove(),y(e,new Date(moment(t).valueOf()+864e5))})};$("#agendaLoadingImg").velocity({rotateZ:"360deg"},{loop:!0});var D=moment(d).format("YYYY-MM-D"),L=moment(d).add(4,"M").format("YYYY-MM-D"),b=0,x=function(){$.getJSON("http://www.zhdk.ch/?agenda/feed&mindate="+D+"&maxdate="+L+"&format=json",null,function(e){w(e,0,24),$("#agendaLoading img").velocity("stop"),$("#agendaLoading").toggle(!1)}).fail(function(){5>b?(b++,x()):($("#agendaLoading img").velocity("stop"),$("#agendaLoading").toggle(!1),$("<div>",{"class":"agendaTileDate roboto",html:"Daten konnten nicht geladen werden. Bitte Seite neu laden."}).appendTo("#agenda"))})};x();var w=function(n,a,o){for(indexLoad=a;o>=indexLoad;++indexLoad){var i=e(n,indexLoad);h=1e3*n.events[indexLoad].startdatum;var l=new Date(h);h!=f&&0==n.events[indexLoad].enddatum&&($("<div>",{id:"agendaTileDate"+h,"class":"agendaTile agendaTileDate roboto",html:moment(l).format("dddd, Do MMM YYYY")}).appendTo("#agenda"),moment(l).format("YYYY-MM-D")==d.format("YYYY-MM-D")&&$("#agendaTileDate"+h).html(moment(l).format("[Heute,] Do MMM YYYY")),moment(l).format("YYYY-MM-D")==s.format("YYYY-MM-D")&&$("#agendaTileDate"+h).html(moment(l).format("[Morgen,] Do MMM YYYY")),f=h),$("<div>",{id:"agendaTile"+indexLoad,"class":"agendaTile"}).appendTo("#agenda").click(function(e){$("#popupEvent").toggleClass("popup"),$("#popupBg").velocity("fadeIn",{duration:400});var a=e.currentTarget.id.replace("agendaTile","");if($("<span>",{html:n.events[a].titel,"class":"eventTitleDetail"}).appendTo("#eventContainer"),$("<img>",{src:"img/clock.svg","class":"eventDateIconDetail"}).appendTo("#eventContainer"),$("<span>",{html:t(n,a),"class":"eventDateDetail"}).appendTo("#eventContainer"),void 0!=n.events[a].loc_shortname&&($("<img>",{src:"img/location.svg","class":"eventLocationIconDetail"}).appendTo("#eventContainer"),$("<span>",{html:n.events[a].loc_shortname,"class":"eventLocationDetail"}).appendTo("#eventContainer")),$("#popupEvent").css("background-image","none"),void 0!=n.events[a].files_info_img&&void 0!=n.events[a].files_info_img[0].thumb_ext_url){var o=n.events[a].files_info_img[0].thumb_ext_url;$("<img>",{src:o,id:"eventImageDetail"}).appendTo("#eventContainer"),void 0!=n.events[a].files_info_img[0].img_ext_url&&($("<img>",{id:"eventImgLoader"}).appendTo("#eventContainer"),$("#eventImgLoader").attr("src",n.events[a].files_info_img[0].img_ext_url).load(function(){$(this).remove(),$("#eventImageDetail").attr("src",n.events[a].files_info_img[0].img_ext_url)}))}var i=n.events[a].beschreibung;void 0!=n.events[a].beschreibung&&$("<p>",{html:i}).appendTo("#eventContainer")}),i=e(n,indexLoad),$("<span>",{html:n.events[indexLoad].titel}).appendTo("#agendaTile"+indexLoad),$("<p>",{html:n.events[indexLoad].kurzbeschreibung,id:"eventBeschreibung"+indexLoad}).appendTo("#agendaTile"+indexLoad),$("#eventBeschreibung"+indexLoad+" a").removeAttr("href"),$("<img>",{src:"img/clock.svg","class":"eventTimeIcon"}).appendTo("#agendaTile"+indexLoad),$("<span>",{html:i,"class":"eventDateAndTime"}).appendTo("#agendaTile"+indexLoad),void 0!=n.events[indexLoad].loc_shortname?($("<img>",{src:"img/location.svg","class":"eventLocationIcon"}).appendTo("#agendaTile"+indexLoad),$("<span>",{html:n.events[indexLoad].loc_shortname,"class":"eventLocation"}).appendTo("#agendaTile"+indexLoad)):$("<span>",{html:"","class":"eventLocation"}).appendTo("#agendaTile"+indexLoad),T=moment(1e3*n.events[indexLoad].startdatum)}T.format("X")<=moment(d).add(3,"M").format("X")&&($("<div>",{id:"agendaTileLoadMore"+indexLoad,"class":"agendaTileLoadMore agendaTile"}).appendTo("#agenda").click(function(){w(n,o+1,o+25),$(".agendaTileLoadMore").toggle(!1)}),$("<img>",{src:"img/agendaNext.svg","class":"agendaNextIcon"}).appendTo("#agendaTileLoadMore"+indexLoad)),v=0,$(".agendaTile").each(function(){$(this).is(":visible")||$(this).hasClass("eventOverTime")||(v++,$(this).delay(100*v).velocity("transition.flipYIn",200))})};$("#tramLoadingImg0").velocity({rotateZ:"360deg"},{loop:!0}),$("#tramLoadingImg1").velocity({rotateZ:"360deg"},{loop:!0}),$("#tramLoadingImg2").velocity({rotateZ:"360deg"},{loop:!0}),$("#tramLoadingImg3").velocity({rotateZ:"360deg"},{loop:!0});var C=0,I=function(){$.get("http://transport.opendata.ch/v1/connections?from=008591398&to=008591374",function(e){O($(e)),$("#tramLoading0 img").velocity("stop"),$("#tramLoading0").toggle(!1)}).fail(function(){5>C?(C++,I()):($("#tramLoading0 img").velocity("stop"),$("#tramLoading0").toggle(!1),$("<p>",{html:"Daten konnten nicht geladen werden. Bitte Seite neu laden."}).appendTo("#toAltstettenTile"))})};I();var k=0,_=function(){$.get("http://transport.opendata.ch/v1/connections?from=008591398&to=008580522",function(e){W($(e)),$("#tramLoading1 img").velocity("stop"),$("#tramLoading1").toggle(!1)}).fail(function(){5>k?(k++,_()):($("#tramLoading1 img").velocity("stop"),$("#tramLoading1").toggle(!1),$("<p>",{html:"Daten konnten nicht geladen werden. Bitte Seite neu laden."}).appendTo("#toTiefenbrunnenTile"))})};_();var z=0,B=function(){$.get("http://transport.opendata.ch/v1/connections?from=008591135&to=008591131",function(e){Z($(e)),$("#tramLoading2 img").velocity("stop"),$("#tramLoading2").toggle(!1)}).fail(function(){5>z?(z++,B()):($("#tramLoading2 img").velocity("stop"),$("#tramLoading2").toggle(!1),$("<p>",{html:"Daten konnten nicht geladen werden. Bitte Seite neu laden."}).appendTo("#toWerdhoelzliTile"))})};B();var H=0,N=function(){$.get("http://transport.opendata.ch/v1/connections?from=008591135&to=008580522",function(e){E($(e)),$("#tramLoading3 img").velocity("stop"),$("#tramLoading3").toggle(!1)}).fail(function(){5>H?(H++,N()):($("#tramLoading3 img").velocity("stop"),$("#tramLoading3").toggle(!1),$("<p>",{html:"Daten konnten nicht geladen werden. Bitte Seite neu laden."}).appendTo("#toEscherWyssPlatzTile"))})};N();var O=function(e){$.each(e.get(0).connections,function(t){var n=new Date(1e3*e.get(0).connections[t].from.departureTimestamp),a="0"+n.getHours(),o="0"+n.getMinutes(),i=a.substr(a.length-2)+":"+o.substr(o.length-2),d=e.get(0).connections[t].products[0];"NFT"==d&&$("<img>",{src:"img/NFT.svg","class":"NFT"}).appendTo("#toAltstetten"+t+" td:last-child"),$("#toAltstetten"+t+" td:nth-child(2)").html("4"),$("#toAltstetten"+t+" td:nth-child(1)").html(i),$("#toAltstettenTile tr").css({"border-top":"1px solid #b4b4af"})})},W=function(e){$.each(e.get(0).connections,function(t){var n=new Date(1e3*e.get(0).connections[t].from.departureTimestamp),a="0"+n.getHours(),o="0"+n.getMinutes(),i=a.substr(a.length-2)+":"+o.substr(o.length-2),d=e.get(0).connections[t].products[0];"NFT"==d&&$("<img>",{src:"img/NFT.svg","class":"NFT"}).appendTo("#toTiefenbrunnen"+t+" td:last-child"),$("#toTiefenbrunnen"+t+" td:nth-child(2)").html("4"),$("#toTiefenbrunnen"+t+" td:nth-child(1)").html(i),$("#toTiefenbrunnenTile tr").css({"border-top":"1px solid #b4b4af"})})},Z=function(e){$.each(e.get(0).connections,function(t){var n=new Date(1e3*e.get(0).connections[t].from.departureTimestamp),a="0"+n.getHours(),o="0"+n.getMinutes(),i=a.substr(a.length-2)+":"+o.substr(o.length-2),d=e.get(0).connections[t].products[0];"NFT"==d&&$("<img>",{src:"img/NFT.svg","class":"NFT"}).appendTo("#toWerdhoelzli"+t+" td:last-child"),$("#toWerdhoelzli"+t+" td:nth-child(2)").html("17"),$("#toWerdhoelzli"+t+" td:nth-child(1)").html(i),$("#toWerdhoelzliTile tr").css({"border-top":"1px solid #b4b4af"})})},E=function(e){$.each(e.get(0).connections,function(t){var n=new Date(1e3*e.get(0).connections[t].from.departureTimestamp),a="0"+n.getHours(),o="0"+n.getMinutes(),i=a.substr(a.length-2)+":"+o.substr(o.length-2),d=e.get(0).connections[t].products[0];"NFT"==d&&$("<img>",{src:"img/NFT.svg","class":"NFT"}).appendTo("#toEscherWyssPlatz"+t+" td:last-child"),$("#toEscherWyssPlatz"+t+" td:nth-child(2)").html("17"),$("#toEscherWyssPlatz"+t+" td:nth-child(1)").html(i),$("#toEscherWyssPlatzTile tr").css({"border-top":"1px solid #b4b4af"})})},F=$("#hamburger");$("#menu").click(function(){F.hasClass("dropdown")?(F.velocity({rotateZ:"0deg"},{duration:300}),$("div#header").velocity({height:"4em"},{duration:300}),$("#headerBg").velocity("fadeOut",{duration:300})):(F.velocity({rotateZ:"180deg"},{duration:300}),$("div#header").velocity({height:"11em"},{duration:300}),$("#headerBg").velocity("fadeIn",{duration:300})),F.toggleClass("dropdown")}),F.click(function(){F.hasClass("dropdown")?(F.velocity({rotateZ:"0deg"},{duration:300}),$("div#header").velocity({height:"4em"},{duration:300}),$("#headerBg").velocity("fadeOut",{duration:300})):(F.velocity({rotateZ:"180deg"},{duration:300}),$("div#header").velocity({height:"11em"},{duration:300}),$("#headerBg").velocity("fadeIn",{duration:300})),F.toggleClass("dropdown")}),$("#menuMensa").click(function(){$("div#header").velocity({height:"4em"},{duration:300}),n.swipeTo(0,400),r.html("mensa"),F.velocity({rotateZ:"0deg"},{duration:300}),F.toggleClass("dropdown"),$("#headerBg").velocity("fadeOut",{duration:300})}),$("#menuAgenda").click(function(){$("div#header").velocity({height:"4em"},{duration:300}),n.swipeTo(1,400),r.html("agenda"),F.velocity({rotateZ:"0deg"},{duration:300}),F.toggleClass("dropdown"),$("#headerBg").velocity("fadeOut",{duration:300})}),$("#menuTram").click(function(){$("div#header").velocity({height:"4em"},{duration:300}),n.swipeTo(2,400),r.html("tram"),F.velocity({rotateZ:"0deg"},{duration:300}),F.toggleClass("dropdown"),$("#headerBg").velocity("fadeOut",{duration:300})}),$("#headerBg").click(function(){$("div#header").velocity({height:"4em"},{duration:300}),F.velocity({rotateZ:"0deg"},{duration:300}),F.toggleClass("dropdown"),$("#headerBg").velocity("fadeOut",{duration:300})}),$("#refresh").click(function(){document.location.reload(!0),$("#refresh").velocity({rotateZ:"1800deg"},{duration:5e3},{loop:!0})}),$("#info").click(function(){$("#popupInfo").toggleClass("popup"),$("#popupBg").velocity("fadeIn",{duration:400})}),$("#popupInfo").click(function(){$("#popupInfo").toggleClass("popup"),$("#popupBg").velocity("fadeOut",{duration:400})}),$("#popupEvent").click(function(){$("#popupEvent").toggleClass("popup"),$("#popupBg").velocity("fadeOut",{duration:400}),$("#eventContainer").empty()}),$(window).on("navigate",function(e,t){var n=t.state.direction;"back"==n&&$("#popupInfo").hasClass("popup")&&(e.preventDefault(),$("#popupInfo").toggleClass("popup"),$("#popupBg").velocity("fadeOut",{duration:400}))})});