"use strict";var Backbone=require("backbone"),$=require("jquery"),_=require("underscore"),Beacons=require("../../helpers/beacons"),template=require("../../templates/Loader/Loader.hbs");Backbone.$=$,module.exports=Backbone.View.extend({loadingTimeout:3e3,beaconPingTime:500,events:{"click .js-loaderTryAgain":"tryAgain","click .js-searchRoom":"searchRoom","click .js-startStream":"startStream"},initialize:function(e){this.delegate=e.delegate,this.initTimers()},render:function(e,i){return e="undefined"==typeof e?!0:e,i="undefined"==typeof i?!1:i,this.$el.html(template({loadingStatus:e,beaconsFound:i,iOSDevice:this.isiOSDevice()})),this.$(".js-spin").velocity({rotateZ:"360deg"},{easing:"linear",duration:2e3,loop:!0}),this},isiOSDevice:function(){return navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)?!0:void 0},initTimers:function(){this.beaconSearchTimer=window.setInterval(_.bind(this.searchBeacons,this),this.beaconPingTime),this.loadingTimer=window.setTimeout(_.bind(this.loadPositionFail,this),this.loadingTimeout)},stopTimers:function(){window.clearTimeout(this.loadingTimer),window.clearInterval(this.beaconSearchTimer)},searchBeacons:function(){Beacons.hasBeacons()&&(this.stopTimers(),this.render(!0,!0))},loadStreamButton:function(){this.$(".js-spin").velocity({rotateZ:"-0deg"}),this.$(".js-spin").addClass("small"),this.$(".button-spinner").addClass("visible")},tryAgain:function(e){e.preventDefault(),this.initTimers(),this.render(!0,!1)},loadPositionFail:function(){this.stopTimers(),this.$(".js-spin").velocity("stop",!0),this.render(!1,!1)},searchRoom:function(e){e.preventDefault(),this.delegate.loadRoomSelectView()},startStream:function(e){e.preventDefault(),this.delegate.loadStreamView()},stop:function(){this.$(".js-spin").velocity("stop",!0),this.stopTimers()}});