"use strict";var Backbone=require("backbone"),_=require("underscore"),$=require("jquery"),Beacons=require("../../helpers/beacons"),StreamCollection=require("../../collections/StreamCollection"),MainStreamView=require("./MainStream"),template=require("../../templates/Stream/Stream.hbs");Backbone.$=$,module.exports=Backbone.View.extend({lastBeacon:{},initialize:function(){console.log("render::StreamView"),Beacons.startBeaconSearchStream(),this.updateBeaconsTimer=window.setInterval(_.bind(this.getBeaconData,this),3e3),this.streamCollection=new StreamCollection},render:function(){return this.$el.html(template()),this.mainStreamView=new MainStreamView({el:this.$("#vStreamEntries"),collection:this.streamCollection}),this},getBeaconData:function(){var e=Beacons.getRoomNames(),t=Beacons.getLastBeacon(),o=t.major+"."+t.minor,a=this.lastBeacon.major+"."+this.lastBeacon.minor;console.log("Old Beacon: "+a+"  ||  New Beacon: "+o),(a!==o||"undefined"==typeof this.lastBeacon)&&(console.log(">> I have a New Beacon, reset collection"),e.length>0?(console.log("Rooms: "+e.join()),this.loadStreamEntries(e)):console.log("No Rooms for this beacon"),this.lastBeacon=t)},loadStreamEntries:function(e){this.streamCollection.fetch({data:{query:e},reset:!0})},stop:function(){window.clearInterval(this.updateBeaconsTimer),this.mainStreamView.disableStream()}});