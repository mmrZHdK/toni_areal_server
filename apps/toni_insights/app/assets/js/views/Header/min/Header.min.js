"use strict";var Backbone=require("backbone"),$=require("jquery"),_=require("underscore"),UserModel=require("../../models/UserModel"),HeaderButton=require("./Button"),HeaderTitleView=require("./Title"),template=require("../../templates/Header/Header.hbs");Backbone.$=$,module.exports=Backbone.View.extend({currentButtonLeft:null,currentButtonRight:null,initialize:function(t){this.delegate=t.delegate,this.buttonUpload=new HeaderButton({iconName:"plus",id:"button-upload",className:"",buttonAction:_.bind(this.buttonUploadAction,this)}),this.buttonRoomSelect=new HeaderButton({iconName:"search",id:"button-roomselect",className:"",buttonAction:_.bind(this.buttonRoomSelectAction,this)}),this.buttonStream=new HeaderButton({iconName:"eye",id:"button-stream",className:"",buttonAction:_.bind(this.buttonStreamAction,this)}),this.buttonBackRight=new HeaderButton({iconName:"arrow-right",id:"button-back-right",className:"",buttonAction:_.bind(this.buttonBackRightAction,this)}),this.actions={vLoader:{left:null,right:null,transition:_.bind(this.transitionToLoader,this),name:"Insights"},vStream:{left:null,right:this.buttonRoomSelect,transition:_.bind(this.transitionToStream,this),name:"Stream"},vRoomSelect:{left:this.buttonStream,right:null,transition:_.bind(this.transitionToRoomSelect,this),name:"Raumauswahl"},vRoom:{left:this.buttonRoomSelect,right:this.buttonUpload,transition:_.bind(this.transitionToRoom,this),name:"Raum"},vUpload:{left:null,right:this.buttonUpload,transition:_.bind(this.transitionToUpload,this),name:"Eintrag hinzuf&uuml;gen"},vUploadForm:{left:null,right:this.buttonUpload,transition:_.bind(this.transitionToUploadForm,this),name:"Eintrag hinzuf&uuml;gen"}},this.render()},render:function(){return this.$el.html(template(UserModel.attributes)),this.headerTitle=new HeaderTitleView({el:this.$("#vHeaderTitle")}),this},prepare:function(t){var e=UserModel.get("selectedRoom"),o=UserModel.get("selectedRoomName"),n=this.actions[t].left,i=this.actions[t].right,a=this.actions[t].name;null!==n&&(n.$el.addClass("header-left"),this.$el.append(n.render().el),n.delegateEvents()),(null!==this.currentButtonLeft&&this.currentButtonLeft!==n||null===n)&&this.removeButton(this.currentButtonLeft),(null!==i||null!==i&&"button-back-right"===i.el.id&&"undefined"!=typeof e)&&(i.$el.addClass("header-right"),this.$el.append(i.render().el),i.delegateEvents()),(null!==this.currentButtonRight&&this.currentButtonRight!==i||null===i)&&this.removeButton(this.currentButtonRight),"vRoom"===t?(this.buttonUpload.setState("add"),a=o):("vUpload"===t||"vUploadForm"===t)&&this.buttonUpload.setState("close"),this.headerTitle.setName(a),this.currentButtonLeft=n,this.currentButtonRight=i},update:function(t,e){console.log("Header::update::from "+e+" to "+t),"self"!==e&&this.actions[t].transition(e),"vLoader"==t?this.hideHeader():(this.$el.hasClass("hidden")&&this.$el.removeClass("hidden"),this.prepare(t))},hideHeader:function(){this.$el.addClass("hidden")},removeButton:function(t){null!==t&&t.$el.remove()},transitionToLoader:function(){},transitionToUpload:function(){this.buttonUpload.$el.velocity({rotateZ:"45deg"})},transitionToUploadForm:function(){},transitionToRoom:function(t){("vUpload"===t||"vUploadForm"===t)&&this.buttonUpload.$el.velocity("reverse")},transitionToRoomSelect:function(){},transitionToStream:function(){console.log("Header::transitionToStream")},buttonUploadAction:function(t){t.preventDefault(),"add"===this.buttonUpload.getState()?this.delegate.loadUploadView():"close"===this.buttonUpload.getState()&&this.delegate.restoreRoomView()},buttonRoomSelectAction:function(t){t.preventDefault(),this.delegate.loadRoomSelectView()},buttonStreamAction:function(t){t.preventDefault(),this.delegate.loadLoaderView()},buttonBackRightAction:function(){this.delegate.loadPreviousView()}});