"use strict";var Backbone=require("backbone"),$=require("jquery"),UserModel=require("../../models/UserModel"),RoomListCollection=require("../../collections/RoomListCollection"),RoomListView=require("./RoomSelect--List"),template=require("../../templates/RoomSelect/RoomSelect--Search.hbs");Backbone.$=$,module.exports=Backbone.View.extend({events:{"keyup .js-searchEbene":"searchEbene","keyup .js-searchGang":"searchGang","keyup .js-searchRaum":"searchRaum","keypress .js-searchRaum":"onEnter","click input":"clickInput"},initialize:function(e){this.delegate=e.delegate,this.roomListCollection=new RoomListCollection,this.roomList=new RoomListView({collection:this.roomListCollection,id:"vRoomList",className:"col-xs-12",delegate:e.delegate}),this.render(),""!==UserModel.attributes.selectedRoom&&""!==UserModel.attributes.searchValEbene&&this.search()},render:function(){return this.$el.html(template(UserModel.toJSON())),this.$el.after(this.roomList.render().el),this},search:function(){var e=this.getSearchValue();return this.roomListCollection.fetch({reset:!0,data:{query:e}}),e},getSearchValue:function(){var e=UserModel.get("searchValEbene"),t=UserModel.get("searchValGang"),r=UserModel.get("searchValRaum");return e+"."+t+r},searchEbene:function(e){var t=$(e.currentTarget).val();this.readValues(),this.search(),this.matchKey(t)&&this.$(".js-searchGang").focus()},searchGang:function(e){var t=$(e.currentTarget).val();this.readValues(),this.search(),this.matchKey(t)&&this.$(".js-searchRaum").focus()},searchRaum:function(e){var t=$(e.currentTarget).val();this.readValues(),this.matchKey(t)&&this.search()},readValues:function(){var e=$(".js-searchEbene").val(),t=$(".js-searchGang").val().toUpperCase(),r=$(".js-searchRaum").val().toUpperCase();UserModel.set("searchValEbene",e),UserModel.set("searchValGang",t),UserModel.set("searchValRaum",r)},matchKey:function(e){return e.match(/(\d+|\w+)/)},submitSearch:function(){var e=this.search(),t=this.roomListCollection.findWhere({roomNrHumanShort:e});Backbone.history.navigate("room/"+t.attributes.id,!1),this.delegate.loadRoomView(t.attributes.id)},onEnter:function(e){(10==e.keyCode||13==e.keyCode)&&(e.preventDefault(),this.submitSearch())},clickInput:function(e){$(e.currentTarget).select()},clearSearchInput:function(){this.$("input").val(""),UserModel.set("searchVal","")}});