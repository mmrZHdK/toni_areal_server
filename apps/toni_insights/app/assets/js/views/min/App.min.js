"use strict";var $=require("jquery"),_=require("underscore"),velocity=require("velocity"),Backbone=require("backbone"),RoomModel=require("../models/RoomModel"),UserModel=require("../models/UserModel"),RoomCollection=require("../collections/RoomCollection"),HeaderView=require("./Header/Header"),LoaderView=require("./Loader/Loader"),StreamView=require("./Stream/Stream"),ContentView=require("./Content"),RoomSelectView=require("./RoomSelect/RoomSelect"),UploadView=require("./Upload/Upload"),UploadFormView=require("./Upload/Upload--Form"),RoomView=require("./Room/Room"),template=require("../templates/App.hbs");Backbone.$=$,require("velocity-animate"),module.exports=Backbone.View.extend({el:$("#app-container"),lastViewObj:null,transitions:{vLoader:{vStream:"left",vRoomSelect:"left"},vStream:{vRoomSelect:"left"},vRoomSelect:{vLoader:"right",vStream:"right",vRoom:"left"},vRoom:{vUpload:{direction:"left",unLoadView:!1},vRoomSelect:"right"},vUpload:{vRoomSelect:"right",vRoom:"right",vUploadForm:"left"},vUploadForm:{vRoom:"right"}},initialize:function(){this.listenTo(UserModel,"change:selectedRoom",this.selectRoom),this.render()},render:function(){return this.$el.html(template()),this.loadHeaderView(),this.loadContentView(),this},loadHeaderView:function(){this.headerView=new HeaderView({el:this.$("#vHeader"),delegate:{getCurrentView:function(){return this.currentView},loadLoaderView:_.bind(this.loadLoaderView,this),loadStreamView:_.bind(this.loadStreamView,this),loadRoomSelectView:_.bind(this.loadRoomSelectView,this),loadRoomView:_.bind(this.loadRoomView,this),restoreRoomView:_.bind(this.restoreRoomView,this),loadUploadView:_.bind(this.loadUploadView,this),loadPreviousView:_.bind(this.loadPreviousView,this)}})},updateHeader:function(e){var i=null!==this.lastViewObj?this.lastViewObj.el.id:"self";this.headerView.update(e,i)},loadContentView:function(){this.contentView=new ContentView({el:this.$("#vContent")})},loadView:function(e,i){if(null===this.lastViewObj)this.contentView.$el.append(i.render().el);else{var o=!0,t="none",a=this.lastViewObj.el.id||"none";if("none"!==a&&(this.transitions[a][e]instanceof Object?(t=this.transitions[a][e].direction||"none",o=this.transitions[a][e].unLoadView||!0):t=this.transitions[a][e]||"none"),"none"!==t){var r=!1;this.transitions[e][a]instanceof Object&&this.transitions[e][a].unLoadView||(r=!0,this.contentView.$el.append(i.render().el)),this.slideOutView(this.lastViewObj,t,o),this.slideInView(i.$el,t,r,i)}else this.contentView.$el.append(i.render().el)}this.updateHeader(e),this.lastViewObj=i},slideOutView:function(e,i,o){var t=e.$el;t.removeAttr("style");var a={left:{left:-t.width()},right:{right:-t.width()}};t.velocity(a[i],{duration:450,easing:"easeInOut",complete:_.bind(function(){this.stopView(e),o&&this.unsetView(e)},this)})},slideInView:function(e,i,o,t){var a={left:{left:0},right:{right:0}},r={left:{left:e.width()},right:{right:e.width()}};o&&e.removeAttr("style"),e.css(r[i]),e.velocity(a[i],{duration:450,easing:"easeInOutQuart",complete:_.bind(function(){this.startView(t)},this)})},startView:function(e){"undefined"!=typeof e.start&&e.start()},stopView:function(e){"undefined"!=typeof e.stop&&e.stop()},unsetView:function(e){e.$el.remove(),e.off(),e=null},loadLoaderView:function(){var e="vLoader";this.loaderView=new LoaderView({id:e,className:"content-view",delegate:{loadRoomSelectView:_.bind(this.loadRoomSelectView,this),loadStreamView:_.bind(this.loadStreamView,this)}}),this.loadView(e,this.loaderView)},loadStreamView:function(){var e="vStream";this.streamView=new StreamView({id:e,className:"content-view",delegate:{}}),this.loadView(e,this.streamView)},loadRoomSelectView:function(e){var i="vRoomSelect";this.roomSelectView=new RoomSelectView({id:i,className:"content-view",comingFromLoader:e,delegate:{requestLoaderView:_.bind(this.loadLoaderView,this),loadRoomView:_.bind(this.prepareRoomView,this)}}),this.loadView(i,this.roomSelectView)},prepareRoomView:function(e){UserModel.set("selectedRoom",e);{var i=new RoomModel({id:e});new RoomCollection(i)}i.fetch({success:_.bind(this.loadRoomView,this)})},loadRoomView:function(e){var i="vRoom";UserModel.set("selectedRoomName",e.attributes.roomNrHumanShort),this.roomView=new RoomView({id:i,className:"content-view",model:e,delegate:{loadUploadView:_.bind(this.loadUploadView,this)}}),this.loadView(i,this.roomView)},restoreRoomView:function(){var e="vRoom";this.loadView(e,this.roomView)},loadUploadView:function(e){var i="vUpload";"undefined"!=typeof e&&UserModel.set("selectedRoom",e),this.uploadView=new UploadView({id:i,className:"content-view",delegate:{restoreRoomView:_.bind(this.restoreRoomView,this),loadUploadFormView:_.bind(this.loadUploadFormView,this)}}),this.loadView(i,this.uploadView)},loadUploadFormView:function(e){var i="vUploadForm";this.uploadFormView=new UploadFormView({id:i,className:"content-view upload-form-container",model:e,delegate:{restoreRoomView:_.bind(this.restoreRoomView,this)}}),this.loadView(i,this.uploadFormView)},loadPreviousView:function(){console.log("TODO: implement previous view")},selectRoom:function(){}});