"use strict";var Backbone=require("backbone"),$=require("jquery"),_=require("underscore"),TextView=require("./Entries/Text"),PictureView=require("./Entries/Picture"),template=require("../../templates/Room/Room--Stream.hbs");Backbone.$=$,module.exports=Backbone.View.extend({events:{"click .stream-element":"initDetailView","click .js-addEntry":"loadUploadView"},collectionPosition:0,streamInterval:2e3,initialize:function(e){var t=e.parentAttributes.id;this.delegate=e.delegate,this.parentAttributes=e.parentAttributes,this.collection.on("reset",this.render,this),this.collection.fetch({reset:!0,data:{id:t}})},render:function(){console.log("render::Room--Stream");this.collection.length;return this.collection.length>0?this.initStream():this.$el.append(template({parentAttributes:this.parentAttributes,collection:this.collection.toJSON()})),this.makeGrid(),this},initStream:function(){this.streamTimer=window.setInterval(_.bind(this.stream,this),this.streamInterval)},stream:function(){"undefined"!=typeof this.collection&&this.collectionPosition<this.collection.length?(this.renderStreamElement(this.collection.at(this.collectionPosition)),this.collectionPosition++):this.disableStream()},disableStream:function(){window.clearInterval(this.streamTimer)},renderStreamElement:function(e){var t=null;switch(console.log(e),e.attributes.entryType){case"text":t=new TextView({model:e});break;case"picture":t=new PictureView({model:e})}t.$el.attr("data-model-id",e.attributes.id),t.$el.attr("data-model-type",e.attributes.entryType),this.$el.append(t.render().el)},makeGrid:function(){var e=$(window).width();this.$el.imagesLoaded(_.bind(function(){this.$el.masonry({itemSelector:".stream-element",columnWidth:e/4})},this))},initDetailView:function(e){e.preventDefault();var t=$(e.currentTarget),i=t.attr("data-model-id"),n=t.attr("data-model-type");if(t.hasClass("img-container")&&(t=t.parent()),console.log(t),t.hasClass("is-open"))this.unloadDetailView(i,n,t),t.velocity("reverse",{complete:_.bind(function(){t.removeClass("is-open"),t.css({height:t.data("initHeight"),"z-index":"auto"})},this)});else{var a=t.hasClass("stream-element-picture")?"100%":"auto";t.data("initHeight",t.height()),t.css({height:a,"z-index":1e3}),t.velocity({width:"100%",left:0},{duration:300,complete:_.bind(function(){this.loadDetailView(i,n,t),t.addClass("is-open")},this)})}},loadDetailView:function(e,t,i){switch(t){case"text":i.find(".content-hidden").velocity("fadeIn")}},unloadDetailView:function(e,t,i){switch(t){case"text":i.find(".content-hidden").velocity("fadeOut",{duration:100})}},loadUploadView:function(e){e.preventDefault(),this.delegate.loadUploadView()}});