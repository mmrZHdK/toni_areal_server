$(document).ready(function(){function e(e,t){var n;return 0!=e.events[t].enddatum?($("#agendaTile"+t).addClass("eventOverTime"),n=moment(1e3*e.events[t].startdatum).format("Do MMM YYYY")+" - "+moment(1e3*e.events[t].enddatum).format("Do MMM YYYY")):n=0!=e.events[t].endzeit?moment(1e3*e.events[t].startzeit).format("HH:mm")+" - "+moment(1e3*e.events[t].endzeit).format("HH:mm"):moment(1e3*e.events[t].startzeit).format("HH:mm"),n}function t(e,t){var n;return 0!=e.events[t].enddatum?($("#agendaTile"+t).addClass("eventOverTime"),n=moment(1e3*e.events[t].startdatum).format("Do MMM YYYY")+" - "+moment(1e3*e.events[t].enddatum).format("Do MMM YYYY")):n=0!=e.events[t].endzeit?moment(1e3*e.events[t].startdatum).format("Do MMM YYYY")+", "+moment(1e3*e.events[t].startzeit).format("HH:mm")+" - "+moment(1e3*e.events[t].endzeit).format("HH:mm"):moment(1e3*e.events[t].startdatum).format("Do MMM YYYY")+", "+moment(1e3*e.events[t].startzeit).format("HH:mm"),n}var n=$(".swiper-container").swiper({mode:"horizontal",loop:!1}),o=($("body"),getEmPixels(body)),a=getEmPixels(),i=(body.clientWidth/o,body.clientWidth/a,new Date(moment().valueOf())),d=moment(),l=moment().add(1,"d"),s=($("#pagesWrapper"),$("#mensa")),r=$("#menu"),m=$("#header"),g=$("#menuMensa"),c=$("#menuAgenda"),p=$("#menuTram"),u=($(window).width(),0),v=0,h=0,f=0;$.ajaxSetup({timeout:5e3}),Date.prototype.getWeek=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil(((this-e)/864e5+e.getDay()+1)/7)},moment.locale("de");n.wrapperTransitionEnd(function(){0==n.activeIndex?(menuChar="mensa",m.addClass("mensa"),m.removeClass("agenda"),m.removeClass("tram"),g.toggle(!1),c.toggle(!0),p.toggle(!0)):1==n.activeIndex?(menuChar="agenda",m.addClass("agenda"),m.removeClass("mensa"),m.removeClass("tram"),g.toggle(!0),c.toggle(!1),p.toggle(!0)):2==n.activeIndex&&(menuChar="tram",m.addClass("tram"),m.removeClass("mensa"),m.removeClass("agenda"),g.toggle(!0),c.toggle(!0),p.toggle(!1)),$("#menu").html(menuChar)},!0),$("#mensaLoadingImg").velocity({rotateZ:"360deg"},{loop:!0});var T=0,Y=function(){$.ajax({url:"http://www.corsproxy.com/zfv.ch/de/microsites/gastronomie-im-toni-areal/menueplan",success:function(e){var t=$(e);$("#mensaLoading img").velocity("stop"),$("#mensaLoading").toggle(!1),6==i.getDay()&&(i=new Date(moment().valueOf()+1728e5)),0==i.getDay()&&(i=new Date(moment().valueOf()+864e5)),y(t,i)},error:function(){console.log("could not get data"),5>T?(T++,Y()):($("#mensaLoading img").velocity("stop"),$("#mensaLoading").toggle(!1),$("<div>",{"class":"mensaTileDate roboto",html:"Daten konnten nicht geladen werden. Es besteht m√∂glicherweise keine Verbindung zum Internet."}).appendTo("#mensa"))},timeout:4e3})};Y();var y=function(e,t){var n=t.getWeek(),a=t.getDay(),i=-5*o;$("#mensa div").each(function(){i=i+$(this).height()+1.15*o}),$("<div>",{id:"mensaTileDate"+a,"class":"mensaTileDate roboto",html:moment(t).format("dddd, Do MMM YYYY")}).appendTo("#mensa"),moment(t).format("YYYY-MM-D")==d.format("YYYY-MM-D")&&$("#mensaTileDate"+a).html(moment(t).format("[Heute,] Do MMM YYYY")),moment(t).format("YYYY-MM-D")==l.format("YYYY-MM-D")&&$("#mensaTileDate"+a).html(moment(t).format("[Morgen,] Do MMM YYYY")),e.find("tbody tr").each(function(e){if($(this).data("dayofweek")==a&&$(this).data("weeknumber")==n){var t=$(this).find(":nth-child(1)"),o=$(this).find(":nth-child(2)");$("<div>",{id:"mensaTile"+e,"class":"mensaTile"}).appendTo("#mensa"),$("<span>",{html:t}).appendTo("#mensaTile"+e),$("<p>",{html:o}).appendTo("#mensaTile"+e),$("#mensaMenu").toggle(!0),$("#mensaMenu tr").toggle(!0),$("#mensaTile"+e+" p br:last-child").remove()}}),5!=t.getDay()&&($("<div>",{id:"mensaTileDate"+a+1,"class":"mensaTile next"}).appendTo("#mensa"),$("<img>",{src:"img/mensaNext.svg","class":"mensaNextIcon"}).appendTo("#mensaTileDate"+a+1)),s.animate({scrollTop:i},600),u=0,$(".mensaTile").each(function(){$(this).is(":visible")||(u++,$(this).delay(100*u).velocity("transition.flipYIn",200))}),$("#mensaTileDate"+a+1).click(function(){$("#mensaTileDate"+a+1).remove(),y(e,new Date(moment(t).valueOf()+864e5))})};$("#agendaLoadingImg").velocity({rotateZ:"360deg"},{loop:!0});var M=moment(d).format("YYYY-MM-D"),D=moment(d).add(4,"M").format("YYYY-MM-D"),L=0,x=function(){$.getJSON("http://www.zhdk.ch/?agenda/feed&mindate="+M+"&maxdate="+D+"&format=json",null,function(e){b(e,0,24),$("#agendaLoading img").velocity("stop"),$("#agendaLoading").toggle(!1)}).fail(function(){5>L?(L++,x()):($("#agendaLoading img").velocity("stop"),$("#agendaLoading").toggle(!1),$("<div>",{"class":"agendaTileDate roboto",html:"Daten konnten nicht geladen werden. Bitte Seite neu laden."}).appendTo("#agenda"))})};x();var b=function(n,o,a){for(indexLoad=o;a>=indexLoad;++indexLoad){var i=e(n,indexLoad);h=1e3*n.events[indexLoad].startdatum;var s=new Date(h);h!=f&&0==n.events[indexLoad].enddatum&&($("<div>",{id:"agendaTileDate"+h,"class":"agendaTile agendaTileDate roboto",html:moment(s).format("dddd, Do MMM YYYY")}).appendTo("#agenda"),moment(s).format("YYYY-MM-D")==d.format("YYYY-MM-D")&&$("#agendaTileDate"+h).html(moment(s).format("[Heute,] Do MMM YYYY")),moment(s).format("YYYY-MM-D")==l.format("YYYY-MM-D")&&$("#agendaTileDate"+h).html(moment(s).format("[Morgen,] Do MMM YYYY"))),f=h,$("<div>",{id:"agendaTile"+indexLoad,"class":"agendaTile"}).appendTo("#agenda").click(function(e){$("#popupEvent").toggleClass("popup"),$("#popupBg").velocity("fadeIn",{duration:400});var o=e.currentTarget.id.replace("agendaTile","");if($("<span>",{html:n.events[o].titel,"class":"eventTitleDetail"}).appendTo("#eventContainer"),$("<img>",{src:"img/clock.svg","class":"eventDateIconDetail"}).appendTo("#eventContainer"),$("<span>",{html:t(n,o),"class":"eventDateDetail"}).appendTo("#eventContainer"),void 0!=n.events[o].loc_shortname&&($("<img>",{src:"img/location.svg","class":"eventLocationIconDetail"}).appendTo("#eventContainer"),$("<span>",{html:n.events[o].loc_shortname,"class":"eventLocationDetail"}).appendTo("#eventContainer")),$("#popupEvent").css("background-image","none"),void 0!=n.events[o].files_info_img&&void 0!=n.events[o].files_info_img[0].thumb_ext_url){var a=n.events[o].files_info_img[0].thumb_ext_url;$("<img>",{src:a,id:"eventImageDetail"}).appendTo("#eventContainer"),void 0!=n.events[o].files_info_img[0].img_ext_url&&($("<img>",{id:"eventImgLoader"}).appendTo("#eventContainer"),$("#eventImgLoader").attr("src",n.events[o].files_info_img[0].img_ext_url).load(function(){$(this).remove(),$("#eventImageDetail").attr("src",n.events[o].files_info_img[0].img_ext_url)}))}var i=n.events[o].beschreibung;void 0!=n.events[o].beschreibung&&$("<p>",{html:i}).appendTo("#eventContainer")}),i=e(n,indexLoad),$("<span>",{html:n.events[indexLoad].titel}).appendTo("#agendaTile"+indexLoad),$("<p>",{html:n.events[indexLoad].kurzbeschreibung,id:"eventBeschreibung"+indexLoad}).appendTo("#agendaTile"+indexLoad),$("#eventBeschreibung"+indexLoad+" a").removeAttr("href"),$("<img>",{src:"img/clock.svg","class":"eventTimeIcon"}).appendTo("#agendaTile"+indexLoad),$("<span>",{html:i,"class":"eventDateAndTime"}).appendTo("#agendaTile"+indexLoad),void 0!=n.events[indexLoad].loc_shortname?($("<img>",{src:"img/location.svg","class":"eventLocationIcon"}).appendTo("#agendaTile"+indexLoad),$("<span>",{html:n.events[indexLoad].loc_shortname,"class":"eventLocation"}).appendTo("#agendaTile"+indexLoad)):$("<span>",{html:"","class":"eventLocation"}).appendTo("#agendaTile"+indexLoad)}$("<div>",{id:"agendaTileLoadMore"+indexLoad,"class":"agendaTileLoadMore agendaTile"}).appendTo("#agenda").click(function(){b(n,a+1,a+25),$(".agendaTileLoadMore").toggle(!1)}),$("<img>",{src:"img/agendaNext.svg","class":"agendaNextIcon"}).appendTo("#agendaTileLoadMore"+indexLoad),v=0,$(".agendaTile").each(function(){$(this).is(":visible")||$(this).hasClass("eventOverTime")||(v++,$(this).delay(100*v).velocity("transition.flipYIn",200))})};$("#tramLoadingImg0").velocity({rotateZ:"360deg"},{loop:!0}),$("#tramLoadingImg1").velocity({rotateZ:"360deg"},{loop:!0}),$("#tramLoadingImg2").velocity({rotateZ:"360deg"},{loop:!0}),$("#tramLoadingImg3").velocity({rotateZ:"360deg"},{loop:!0});var w=0,C=function(){$.get("http://transport.opendata.ch/v1/connections?from=008591398&to=008591374",function(e){O($(e)),$("#tramLoading0 img").velocity("stop"),$("#tramLoading0").toggle(!1)}).fail(function(){5>w?(w++,C()):($("#tramLoading0 img").velocity("stop"),$("#tramLoading0").toggle(!1),$("<p>",{html:"Daten konnten nicht geladen werden. Bitte Seite neu laden."}).appendTo("#toAltstettenTile"))})};C();var I=0,k=function(){$.get("http://transport.opendata.ch/v1/connections?from=008591398&to=008580522",function(e){W($(e)),$("#tramLoading1 img").velocity("stop"),$("#tramLoading1").toggle(!1)}).fail(function(){5>I?(I++,k()):($("#tramLoading1 img").velocity("stop"),$("#tramLoading1").toggle(!1),$("<p>",{html:"Daten konnten nicht geladen werden. Bitte Seite neu laden."}).appendTo("#toTiefenbrunnenTile"))})};k();var _=0,z=function(){$.get("http://transport.opendata.ch/v1/connections?from=008591135&to=008591131",function(e){Z($(e)),$("#tramLoading2 img").velocity("stop"),$("#tramLoading2").toggle(!1)}).fail(function(){5>_?(_++,z()):($("#tramLoading2 img").velocity("stop"),$("#tramLoading2").toggle(!1),$("<p>",{html:"Daten konnten nicht geladen werden. Bitte Seite neu laden."}).appendTo("#toWerdhoelzliTile"))})};z();var B=0,H=function(){$.get("http://transport.opendata.ch/v1/connections?from=008591135&to=008580522",function(e){E($(e)),$("#tramLoading3 img").velocity("stop"),$("#tramLoading3").toggle(!1)}).fail(function(){5>B?(B++,H()):($("#tramLoading3 img").velocity("stop"),$("#tramLoading3").toggle(!1),$("<p>",{html:"Daten konnten nicht geladen werden. Bitte Seite neu laden."}).appendTo("#toEscherWyssPlatzTile"))})};H();var O=function(e){$.each(e.get(0).connections,function(t){var n=new Date(1e3*e.get(0).connections[t].from.departureTimestamp),o="0"+n.getHours(),a="0"+n.getMinutes(),i=o.substr(o.length-2)+":"+a.substr(a.length-2),d=e.get(0).connections[t].products[0];$("#toAltstetten"+t+" td:nth-child(2)").html(d),$("#toAltstetten"+t+" td:last-child").html("4"),$("#toAltstetten"+t+" td:nth-child(1)").html(i),$("#toAltstettenTile tr").css({"border-top":"1px solid #d4d4cc"})})},W=function(e){$.each(e.get(0).connections,function(t){var n=new Date(1e3*e.get(0).connections[t].from.departureTimestamp),o="0"+n.getHours(),a="0"+n.getMinutes(),i=o.substr(o.length-2)+":"+a.substr(a.length-2),d=e.get(0).connections[t].products[0];$("#toTiefenbrunnen"+t+" td:nth-child(2)").html(d),$("#toTiefenbrunnen"+t+" td:last-child").html("4"),$("#toTiefenbrunnen"+t+" td:nth-child(1)").html(i),$("#toTiefenbrunnenTile tr").css({"border-top":"1px solid #d4d4cc"})})},Z=function(e){$.each(e.get(0).connections,function(t){var n=new Date(1e3*e.get(0).connections[t].from.departureTimestamp),o="0"+n.getHours(),a="0"+n.getMinutes(),i=o.substr(o.length-2)+":"+a.substr(a.length-2),d=e.get(0).connections[t].products[0];$("#toWerdhoelzli"+t+" td:nth-child(2)").html(d),$("#toWerdhoelzli"+t+" td:last-child").html("17"),$("#toWerdhoelzli"+t+" td:nth-child(1)").html(i),$("#toWerdhoelzliTile tr").css({"border-top":"1px solid #d4d4cc"})})},E=function(e){$.each(e.get(0).connections,function(t){var n=new Date(1e3*e.get(0).connections[t].from.departureTimestamp),o="0"+n.getHours(),a="0"+n.getMinutes(),i=o.substr(o.length-2)+":"+a.substr(a.length-2),d=e.get(0).connections[t].products[0];$("#toEscherWyssPlatz"+t+" td:nth-child(2)").html(d),$("#toEscherWyssPlatz"+t+" td:last-child").html("17"),$("#toEscherWyssPlatz"+t+" td:nth-child(1)").html(i),$("#toEscherWyssPlatzTile tr").css({"border-top":"1px solid #d4d4cc"})})},A=$("#hamburger");$("#menu").click(function(){A.hasClass("dropdown")?(A.velocity({rotateZ:"0deg"},{duration:300}),$("div#header").velocity({height:"4em"},{duration:300}),$("#headerBg").velocity("fadeOut",{duration:300})):(A.velocity({rotateZ:"180deg"},{duration:300}),$("div#header").velocity({height:"11em"},{duration:300}),$("#headerBg").velocity("fadeIn",{duration:300})),A.toggleClass("dropdown")}),A.click(function(){A.hasClass("dropdown")?(A.velocity({rotateZ:"0deg"},{duration:300}),$("div#header").velocity({height:"4em"},{duration:300}),$("#headerBg").velocity("fadeOut",{duration:300})):(A.velocity({rotateZ:"180deg"},{duration:300}),$("div#header").velocity({height:"11em"},{duration:300}),$("#headerBg").velocity("fadeIn",{duration:300})),A.toggleClass("dropdown")}),$("#menuMensa").click(function(){$("div#header").velocity({height:"4em"},{duration:300}),n.swipeTo(0,400),r.html("mensa"),A.velocity({rotateZ:"0deg"},{duration:300}),A.toggleClass("dropdown"),$("#headerBg").velocity("fadeOut",{duration:300})}),$("#menuAgenda").click(function(){$("div#header").velocity({height:"4em"},{duration:300}),n.swipeTo(1,400),r.html("agenda"),A.velocity({rotateZ:"0deg"},{duration:300}),A.toggleClass("dropdown"),$("#headerBg").velocity("fadeOut",{duration:300})}),$("#menuTram").click(function(){$("div#header").velocity({height:"4em"},{duration:300}),n.swipeTo(2,400),r.html("tram"),A.velocity({rotateZ:"0deg"},{duration:300}),A.toggleClass("dropdown"),$("#headerBg").velocity("fadeOut",{duration:300})}),$("#headerBg").click(function(){$("div#header").velocity({height:"4em"},{duration:300}),A.velocity({rotateZ:"0deg"},{duration:300}),A.toggleClass("dropdown"),$("#headerBg").velocity("fadeOut",{duration:300})}),$("#refresh").click(function(){document.location.reload(!0),$("#refresh").velocity({rotateZ:"1800deg"},{duration:5e3},{loop:!0})}),$("#info").click(function(){$("#popupInfo").toggleClass("popup"),$("#popupBg").velocity("fadeIn",{duration:400})}),$("#popupInfo").click(function(){$("#popupInfo").toggleClass("popup"),$("#popupBg").velocity("fadeOut",{duration:400})}),$("#popupEvent").click(function(){$("#popupEvent").toggleClass("popup"),$("#popupBg").velocity("fadeOut",{duration:400}),$("#eventContainer").empty()}),$(window).on("navigate",function(e,t){var n=t.state.direction;"back"==n&&$("#popupInfo").hasClass("popup")&&(e.preventDefault(),$("#popupInfo").toggleClass("popup"),$("#popupBg").velocity("fadeOut",{duration:400}))})});