var roomSearchModule=angular.module("roomSearchModule",["ngResource","ng-iscroll"]).controller("RoomSearchController",["$scope","$http","$resource","RoomSearchService","MapService","$timeout","$window","ControlBarService",function(e,o,t,i,r,n,c,s){e.init=function(){e.resultlistheight={height:c.innerHeight-85+"px"},e.roomFindingActive=!1,e.roomSearchQuery="",e.$parent.myScrollOptions={"room-search-result-scroll-pane":{snap:!1,click:!0,onScrollEnd:function(){}}}},e.loadRoomSearchResults=function(){i.searchRooms(e.roomSearchQuery)},e.magnifierClicked=function(){$("input#room-search-box").focus()},e.roomSearchHasFocus=function(){i.setSearchActive(!0),e.resizeResultList()},e.roomSearchLoseFocus=function(){e.roomSearchQuery.length<=0?(i.setSearchActive(!1),e.resizeResultList()):e.roomSearchQuery="",i.rooms={},i.updateRoomList()},e.deactivateInputField=function(){e.resizeResultList()},e.selectRoom=function(o){i.setSearchActive(!1),i.setFindingActive(!0),r.highlightRoom(o),s.startRoomFindingMode(o),e.roomSearchQuery=null!=o.additionalDescription&&o.additionalDescription.length>0?o.additionalDescription:o.signalRoomNr,e.isSpecialRoom=null!=o.additionalDescription&&o.additionalDescription.length>0},e.roomFindCancel=function(){i.roomSearchActive&&i.roomFindingActive?e.roomSearchLoseFocus():(i.setFindingActive(!1),i.setSearchActive(!1),r.dehighlightRoom(),s.cancelRoomFindingMode())},e.resizeResultList=function(){e.resultlistheight={height:c.innerHeight-85+"px"},e.$parent.myScroll["room-search-result-scroll-pane"].refresh()},e.$on("roomListUpdated",function(){e.rooms=i.rooms,e.showList=e.rooms.length>0,e.showList&&n(function(){e.$parent.myScroll["room-search-result-scroll-pane"].refresh()},0)}),e.$on("roomSearchActiveChanged",function(){e.searchActive=i.roomSearchActive,e.searchActive||$("#room-search-box").blur()}),e.$on("roomFindingActiveChanged",function(){e.findingActive=i.roomFindingActive,e.findingActive||(e.roomSearchQuery="")}),e.init()}]).service("RoomSearchService",["$http","$resource","$rootScope",function(e,o,t){var i=this;e.defaults.useXDomain=!0,this.searchRooms=function(e){if(e.length>=3){var t=e.split(".").join("");t=t.replace(/\s/g,""),console.log(t);var r=o("http://exohosting.ch/toniareal/api/v1/rooms/all/:searchQuery",{searchQuery:"@searchQuery"});r.query({searchQuery:t}).$promise.then(function(e){i.rooms=e,i.isFavourites=!1,i.updateRoomList()})}else if(0==e.length){var r=o("http://exohosting.ch/toniareal/api/v1/rooms/favourites",{});r.query().$promise.then(function(e){i.rooms=e,i.isFavourites=!0,i.updateRoomList()})}else this.rooms={},this.isFavourites=!1,this.updateRoomList()},this.updateRoomList=function(){t.$broadcast("roomListUpdated")},this.setSearchActive=function(e){this.roomSearchActive=e,t.$broadcast("roomSearchActiveChanged")},this.setFindingActive=function(e){this.roomFindingActive=e,t.$broadcast("roomFindingActiveChanged")}}]).directive("tmRoomSearchResults",function(){return{restrict:"E",templateUrl:"build/templates/roomsearch/templates/results.template.html",link:function(){}}}).directive("tmRoomSearchResultItem",function(){return{restrict:"E",templateUrl:"build/templates/roomsearch/templates/resultitem.template.html"}}).directive("tmRoomSearchBox",function(){return{restrict:"E",templateUrl:"build/templates/roomsearch/templates/searchbox.template.html"}});