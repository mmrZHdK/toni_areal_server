/* JS Custom Scripts - Compressed and Uglified */ 

(function() {

!function(){var app=(angular.module("helpers",[]).directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(scope,el){el.replaceWith(el.children())}}}),angular.module("services",[]),angular.module("controlBarModule",[]).controller("ControlBarController",["$scope","MapService","$timeout","ControlBarService",function($scope,MapService,$timeout,ControlBarService){$scope.init=function(){$scope.initializing=!0,$scope.data={},$scope.data.room={},$scope.data.showFloorFlyout=!1,$scope.data.floor=0,$scope.data.handleValue=0},$scope.toggleFloorFlyout=function(){ControlBarService.toggleFloorFlyout()},$scope.closeFloorFlyout=function(){ControlBarService.closeFloorFlyout()},$scope.toggleSideMenu=function(){ControlBarService.toggleSideMenu()},$scope.closeSideMenu=function(){ControlBarService.closeSideMenu()},$scope.startPositioning=function(){ControlBarService.startPositioning()},$scope.stopPositioning=function(){ControlBarService.stopPositioning()},$scope.changeVal=function(){$scope.data.floor=2},$scope.$watch("data.floor",function(){$scope.initializing?$timeout(function(){$scope.initializing=!1}):(MapService.switchFloor($scope.data.floor),$scope.closeFloorFlyout())}),$scope.$watch("data.handleValue",function(){$(".noUi-handle-lower").html($scope.data.handleValue)}),$scope.$on("floorFlyoutChanged",function(){$scope.data.showFloorFlyout=ControlBarService.showFloorFlyout}),$scope.$on("roomFindingModeStarted",function(){$scope.data.room=ControlBarService.room,$scope.data.roomFindMode=!0}),$scope.$on("roomFindingModeCanceled",function(){$scope.data.room=null,$scope.data.roomFindMode=!1}),$scope.$on("positioningModeChanged",function(){$scope.data.isPositioningMode=ControlBarService.isPositioningMode}),$scope.$on("mapIsInitialized",function(){$scope.data.handleValue=MapService.currentFloor}),$scope.init()}]).service("ControlBarService",["$rootScope",function($rootScope){this.closeFloorFlyout=function(){this.showFloorFlyout=!1,$rootScope.$broadcast("floorFlyoutChanged")},this.toggleFloorFlyout=function(){this.showFloorFlyout=!this.showFloorFlyout,$rootScope.$broadcast("floorFlyoutChanged")},this.startRoomFindingMode=function(room){this.room=room,$rootScope.$broadcast("roomFindingModeStarted")},this.cancelRoomFindingMode=function(){$rootScope.$broadcast("roomFindingModeCanceled")},this.toggleSideMenu=function(){this.showSideMenu=!this.showSideMenu,$rootScope.$broadcast("sideMenuChanged")},this.cliseSideMenu=function(){this.showSideMenu=!1,$rootScope.$broadcast("sideMenuChanged")},this.startPositioning=function(){this.isPositioningMode=!0,$rootScope.$broadcast("positioningModeChanged")},this.stopPositioning=function(){this.isPositioningMode=!1,$rootScope.$broadcast("positioningModeChanged")}}]).directive("tmRoomDisplay",function(){return{restrict:"E",templateUrl:"build/templates/controlbar/templates/roomdisplay.template.html",link:function(){}}}).directive("tmFloorNavigation",function(){return{restrict:"E",templateUrl:"build/templates/controlbar/templates/floornavigation.template.html",link:function(){}}}),angular.module("mapModule",[]).controller("MapController",["$scope","$rootScope","$routeParams","MapService","RoomSearchService","ControlBarService","$window","$timeout",function($scope,$rootScope,$routeParams,MapService,RoomSearchService,ControlBarService,$window,$timeout){$scope.init=function(){$scope.data={},$scope.data.svgUrl="build/maps/toni_map_floor_"+$routeParams.floor+".svg",MapService.currentFloor=$routeParams.floor,$scope.data.currentFloor=MapService.currentFloor,$scope.data.nextFloorIsHigher=MapService.nextFloorIsHigher,$scope.data.hideRoomLabels=!0,$scope.data.hideIconsAll=!0,$scope.data.hideIconsFood=MapService.hideIconsFood,$scope.data.hideIconsCopy=MapService.hideIconsCopy,$scope.data.hideIconsSurf=MapService.hideIconsSurf,$scope.data.hideIconsToilets=MapService.hideIconsToilets,$scope.data.hideIconsElevators=MapService.hideIconsElevators,$scope.data.hideIconsRecycle=MapService.hideIconsRecycle,$scope.data.zoom=.5,$scope.data.tempScale=.5,$rootScope.$broadcast("mapIsInitialized")},$scope.initSvg=function(){var section=$("#map-pane-"+$scope.data.currentFloor);$scope.svg=section.find("svg"),$scope.svg.panzoom({increment:.5,maxScale:15,minScale:.5,onPan:$scope.mapMoved,onZoom:$scope.mapZoomed}),$scope.markRoomShape(),MapService.isMovingToHighlightRoom?($scope.moveToRoomShape(),MapService.isMovingToHighlightRoom=!1):($scope.svg.panzoom("zoom",.5),$scope.svg.panzoom("pan",-225,-320))},$scope.markRoomShape=function(){if(void 0!==MapService.roomToHighlight&&null!==MapService.roomToHighlight){var shape=$('[id="'+MapService.roomToHighlight.planRoomNr+'"]');null!=shape&&shape.get(0).setAttribute("class","svg-room highlighted")}},$scope.unmarkRoomShape=function(){if(void 0!==MapService.roomToHighlight&&null!==MapService.roomToHighlight){var shape=$('[id="'+MapService.roomToHighlight.planRoomNr+'"]');null!=shape&&(shape.get(0).setAttribute("class","svg-room"),MapService.roomToHighlight=null)}},$scope.moveToRoomShape=function(){if(void 0!==MapService.roomToHighlight&&null!==MapService.roomToHighlight){$scope.svg.panzoom("zoom",1.5,{animate:!1});var roomShape=$('[id="'+MapService.roomToHighlight.planRoomNr+'"]'),pos=roomShape.position(),focalPos={};focalPos.clientX=$window.innerWidth/2-(pos.left+roomShape.get(0).getBoundingClientRect().width/2),focalPos.clientY=$window.innerHeight/2-(pos.top+roomShape.get(0).getBoundingClientRect().height/2),$scope.svg.panzoom("pan",focalPos.clientX,focalPos.clientY,{relative:!0,animate:!0})}},$scope.mapMoved=function(){ControlBarService.showFloorFlyout&&ControlBarService.closeFloorFlyout()},$scope.mapZoomed=function(e,panzoom,scale){Math.abs(scale-$scope.data.tempScale)>.2&&($timeout(function(){$scope.data.hideRoomLabels=1.2>scale,$scope.data.hideIconsAll=.7>scale},100),$scope.data.tempScale=scale)},$scope.$watch("data.zoom",function(){void 0!==$scope.svg&&$scope.svg.panzoom("zoom",.015*$scope.data.zoom+.5)}),$scope.$on("hightlightRoomOnSameFloor",function(){$scope.markRoomShape(),$scope.moveToRoomShape()}),$scope.$on("unhightlightRoom",function(){$scope.unmarkRoomShape()}),$scope.$on("mapTransition",function(){$scope.data.nextFloorIsHigher=MapService.nextFloorIsHigher}),$scope.$on("hideIconsChanged",function(){$scope.data.hideIconsFood=MapService.hideIconsFood,$scope.data.hideIconsCopy=MapService.hideIconsCopy,$scope.data.hideIconsSurf=MapService.hideIconsSurf,$scope.data.hideIconsToilets=MapService.hideIconsToilets,$scope.data.hideIconsElevators=MapService.hideIconsElevators,$scope.data.hideIconsRecycle=MapService.hideIconsRecycle}),$scope.init()}]).service("MapService",["$rootScope","$location","RoomSearchService","$timeout",function($rootScope,$location,RoomSearchService,$timeout){var self=this;this.highlightRoom=function(room){this.isMovingToHighlightRoom=!0,this.roomToHighlight=room,room.floor!=this.currentFloor?$timeout(function(){self.haveToMarkOnOtherFloor=!0,self.switchFloor(room.floor)},300):$timeout(function(){$rootScope.$broadcast("hightlightRoomOnSameFloor")},300)},this.dehighlightRoom=function(){$rootScope.$broadcast("unhightlightRoom")},this.switchFloor=function(newFloor){this.currentFloor!=newFloor&&(this.nextFloorIsHigher=newFloor>this.currentFloor,$rootScope.$broadcast("mapTransition"),$location.path("/map/"+newFloor))},this.setHideIconsFood=function(hideIconsFood){this.hideIconsFood=hideIconsFood,$rootScope.$broadcast("hideIconsChanged")},this.setHideIconsCopy=function(hideIconsCopy){this.hideIconsCopy=hideIconsCopy,$rootScope.$broadcast("hideIconsChanged")},this.setHideIconsSurf=function(hideIconsSurf){this.hideIconsSurf=hideIconsSurf,$rootScope.$broadcast("hideIconsChanged")},this.setHideIconsToilets=function(hideIconsToilets){this.hideIconsToilets=hideIconsToilets,$rootScope.$broadcast("hideIconsChanged")},this.setHideIconsElevators=function(hideIconsElevators){this.hideIconsElevators=hideIconsElevators,$rootScope.$broadcast("hideIconsChanged")},this.setHideIconsRecycle=function(hideIconsRecycle){this.hideIconsRecycle=hideIconsRecycle,$rootScope.$broadcast("hideIconsChanged")}}]).directive("tmMap",function(){return{restrict:"E",template:'<div ng-include="data.svgUrl" include-replace onload="initSvg()"></div>',link:function(){}}}),angular.module("roomSearchModule",["ngResource","ng-iscroll"]).controller("RoomSearchController",["$scope","$http","$resource","RoomSearchService","MapService","$timeout","$window","ControlBarService",function($scope,$http,$resource,RoomSearchService,MapService,$timeout,$window,ControlBarService){$scope.init=function(){$scope.resultlistheight={height:$window.innerHeight-85+"px"},$scope.roomFindingActive=!1,$scope.$parent.myScrollOptions={"room-search-result-scroll-pane":{snap:!1,click:!0,onScrollEnd:function(){}}}},$scope.loadRoomSearchResults=function(){RoomSearchService.searchRooms($scope.roomSearchQuery)},$scope.roomSearchHasFocus=function(){RoomSearchService.setSearchActive(!0),$scope.resizeResultList()},$scope.roomSearchLoseFocus=function(){RoomSearchService.setSearchActive(!1),$scope.resizeResultList()},$scope.deactivateInputField=function(){$scope.resizeResultList()},$scope.selectRoom=function(room){RoomSearchService.setSearchActive(!1),RoomSearchService.setFindingActive(!0),MapService.highlightRoom(room),ControlBarService.startRoomFindingMode(room),$scope.roomSearchQuery=room.signalRoomNr},$scope.roomFindCancel=function(){RoomSearchService.setFindingActive(!1),RoomSearchService.setSearchActive(!1),MapService.dehighlightRoom(),ControlBarService.cancelRoomFindingMode()},$scope.resizeResultList=function(){$scope.resultlistheight={height:$window.innerHeight-85+"px"},$scope.$parent.myScroll["room-search-result-scroll-pane"].refresh()},$scope.$on("roomListUpdated",function(){$scope.rooms=RoomSearchService.rooms,$scope.showList=$scope.rooms.length>0,$scope.showList&&$timeout(function(){$scope.$parent.myScroll["room-search-result-scroll-pane"].refresh()},0)}),$scope.$on("roomSearchActiveChanged",function(){$scope.searchActive=RoomSearchService.roomSearchActive,$scope.searchActive?ControlBarService.closeFloorFlyout():$("#room-search-box").blur()}),$scope.$on("roomFindingActiveChanged",function(){$scope.findingActive=RoomSearchService.roomFindingActive,$scope.findingActive||($scope.roomSearchQuery="")}),$scope.init()}]).service("RoomSearchService",["$http","$resource","$rootScope",function($http,$resource,$rootScope){var self=this;$http.defaults.useXDomain=!0,this.searchRooms=function(roomSearchQuery){if(roomSearchQuery.length>=3){var roomService=$resource("http://exohosting.ch/toniareal/api/v1/rooms/all/:searchQuery",{searchQuery:"@searchQuery"});roomService.query({searchQuery:roomSearchQuery}).$promise.then(function(rooms){self.rooms=rooms,self.isFavourites=!1,self.updateRoomList()})}else if(0==roomSearchQuery.length){var roomService=$resource("http://exohosting.ch/toniareal/api/v1/rooms/favourites",{});roomService.query().$promise.then(function(rooms){self.rooms=rooms,self.isFavourites=!0,self.updateRoomList()})}else this.rooms={},this.isFavourites=!1,this.updateRoomList()},this.updateRoomList=function(){$rootScope.$broadcast("roomListUpdated")},this.setSearchActive=function(active){this.roomSearchActive=active,$rootScope.$broadcast("roomSearchActiveChanged")},this.setFindingActive=function(active){this.roomFindingActive=active,$rootScope.$broadcast("roomFindingActiveChanged")}}]).directive("tmRoomSearchResults",function(){return{restrict:"E",templateUrl:"build/templates/roomSearch/templates/results.template.html",link:function(){}}}).directive("tmRoomSearchResultItem",function(){return{restrict:"E",templateUrl:"build/templates/roomSearch/templates/resultitem.template.html"}}).directive("tmRoomSearchBox",function(){return{restrict:"E",templateUrl:"build/templates/roomSearch/templates/searchbox.template.html"}}),angular.module("sideMenuModule",[]).controller("SideMenuController",["$scope","ControlBarService","MapService",function($scope,ControlBarService,MapService){$scope.init=function(){$scope.data={},$scope.data.showSideMenu=!1,$scope.data.showIconsFood=!MapService.hideIconsFood,$scope.data.showIconsCopy=!MapService.hideIconsCopy,$scope.data.showIconsSurf=!MapService.hideIconsSurf,$scope.data.showIconsToilets=!MapService.hideIconsToilets,$scope.data.showIconsElevators=!MapService.hideIconsElevators,$scope.data.showIconsRecycle=!MapService.hideIconsRecycle},$scope.$on("sideMenuChanged",function(){$scope.data.showSideMenu=ControlBarService.showSideMenu,$scope.data.showSideMenu?$("#wrapper-all").addClass("side-menu-offset"):$("#wrapper-all").removeClass("side-menu-offset")}),$scope.$watch("data.showIconsFood",function(){MapService.setHideIconsFood(!$scope.data.showIconsFood)}),$scope.$watch("data.showIconsCopy",function(){MapService.setHideIconsCopy(!$scope.data.showIconsCopy)}),$scope.$watch("data.showIconsSurf",function(){MapService.setHideIconsSurf(!$scope.data.showIconsSurf)}),$scope.$watch("data.showIconsToilets",function(){MapService.setHideIconsToilets(!$scope.data.showIconsToilets)}),$scope.$watch("data.showIconsElevators",function(){MapService.setHideIconsElevators(!$scope.data.showIconsElevators)}),$scope.$watch("data.showIconsRecycle",function(){MapService.setHideIconsRecycle(!$scope.data.showIconsRecycle)}),$scope.init()}]).directive("tmSideMenu",function(){return{restrict:"E",templateUrl:"build/templates/sidemenu/templates/sidemenu.template.html",link:function(){}}}),new angular.module("toniMapsModule",["mapModule","roomSearchModule","controlBarModule","sideMenuModule","ngRoute","ngAnimate","ngAnimate-animate.css","helpers","nouislider","NgSwitchery"]));app.config(["$routeProvider",function($routeProvider){$routeProvider.when("/map/:floor",{templateUrl:"build/views/map.view.html",controller:"MapController"}).otherwise({redirectTo:"/map/3"})}]).controller("WrapperController",["$scope","ControlBarService",function($scope,ControlBarService){$scope.toggleSideMenu=function(){ControlBarService.toggleSideMenu()}}])}();

})();