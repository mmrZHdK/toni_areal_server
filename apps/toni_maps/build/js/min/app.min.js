!function(){!function(){function o(){var o=window.innerHeight?window.innerHeight:$(window).height();$("body").height(o),$("html").height(o),$(".wrapper-all").height(o)}angular.module("helpers",[]).directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(o,i){i.replaceWith(i.children())}}}),angular.module("services",[]),angular.module("controlBarModule",[]).controller("ControlBarController",["$scope","MapService","$timeout","ControlBarService","RoomSearchService",function(o,i,t,e){o.init=function(){o.initializing=!0,o.data={},o.data.room={},o.data.floor=0},o.toggleSideMenu=function(){e.toggleSideMenu()},o.closeSideMenu=function(){e.closeSideMenu()},o.startPositioning=function(){i.showMyPosition(),o.data.isPositioningMode=!0},o.stopPositioning=function(){o.data.isPositioningMode=!1},o.startRouting=function(){var o=0,t=0;i.findRoute(o,t)},o.setFloor=function(i){o.data.floor=i},o.$watch("data.floor",function(){o.initializing?t(function(){o.initializing=!1}):i.switchFloor(o.data.floor)}),o.$on("roomFindingModeStarted",function(){o.data.room=e.room,o.data.roomFindMode=!0}),o.$on("roomFindingModeCanceled",function(){o.data.room=null,o.data.roomFindMode=!1}),o.$on("mapIsInitialized",function(){o.data.floor=i.currentFloor}),o.$on("deactivatePositioningButton",function(){o.stopPositioning()}),o.init()}]).service("ControlBarService",["$rootScope",function(o){this.startRoomFindingMode=function(i){this.room=i,o.$broadcast("roomFindingModeStarted")},this.cancelRoomFindingMode=function(){o.$broadcast("roomFindingModeCanceled")},this.toggleSideMenu=function(){this.showSideMenu=!this.showSideMenu,o.$broadcast("sideMenuChanged")},this.cliseSideMenu=function(){this.showSideMenu=!1,o.$broadcast("sideMenuChanged")},this.deactivatePositioningButton=function(){o.$broadcast("deactivatePositioningButton")}}]).directive("tmRoomDisplay",function(){return{restrict:"E",templateUrl:"build/templates/controlbar/templates/roomdisplay.template.html",link:function(){}}}).directive("tmFloorNavigation",function(){return{restrict:"E",templateUrl:"build/templates/controlbar/templates/floornavigation.template.html",link:function(){}}}),angular.module("mapModule",[]).controller("MapController",["$scope","$rootScope","$routeParams","MapService","RoomSearchService","ControlBarService","$window","$timeout",function(o,i,t,e,n,a,r,s){o.init=function(){o.data={},o.data.svgUrl="build/maps/toni_map_floor_"+t.floor+".svg?v=1",e.currentFloor=t.floor,o.data.currentFloor=e.currentFloor,o.data.nextFloorIsHigher=e.nextFloorIsHigher,o.data.hideRoomLabels=!0,o.data.hideIconsAll=!0,o.data.hideIconsFood=e.hideIconsFood,o.data.hideIconsCopy=e.hideIconsCopy,o.data.hideIconsSurf=e.hideIconsSurf,o.data.hideIconsToilets=e.hideIconsToilets,o.data.hideIconsElevators=e.hideIconsElevators,o.data.hideIconsRecycle=e.hideIconsRecycle,o.data.zoom=2.5,o.data.tempScale=.5,i.$broadcast("mapIsInitialized")},o.initSvg=function(){o.svg=$("#map-pane-"+o.data.currentFloor+" svg"),o.svg.panzoom({increment:.5,maxScale:15,minScale:.5,onPan:o.mapMoved,onZoom:o.mapZoomed}),o.snapSvg=Snap("#map-pane-"+o.data.currentFloor+" svg"),Snap.load("build/pathmeshes/toni_pathmesh_"+o.data.currentFloor+".svg?v=1",function(i){o.snapSvg.append(i),o.markRoomShape(),o.showMyPosition(),o.paintRoute(),e.isMovingToHighlightRoom?s(function(){o.moveToRoomShape()},200):(o.svg.panzoom("zoom",.5),o.svg.panzoom("pan",-225,-320)),e.isMovingToMyPosition&&s(function(){o.moveToMyPosition()},200)})},o.markRoomShape=function(){if(void 0!==e.roomToHighlight&&null!==e.roomToHighlight){var o=Snap('[id="'+e.roomToHighlight.planRoomNr+'"]');null!=o&&o.addClass("highlighted")}},o.unmarkRoomShape=function(){if(void 0!==e.roomToHighlight&&null!==e.roomToHighlight){var o=$('[id="'+e.roomToHighlight.planRoomNr+'"]'),o=Snap('[id="'+e.roomToHighlight.planRoomNr+'"]');null!=o&&(o.removeClass("highlighted"),e.roomToHighlight=null)}},o.moveToRoomShape=function(){void 0!==e.roomToHighlight&&null!==e.roomToHighlight&&s(function(){o.svg.panzoom("zoom",1.5,{animate:!1});var i=$('[id="'+e.roomToHighlight.planRoomNr+'"]');if(i.length>0){var t=i.position(),n={};n.clientX=r.innerWidth/2-(t.left+i.get(0).getBoundingClientRect().width/2),n.clientY=r.innerHeight/2-(t.top+i.get(0).getBoundingClientRect().height/2),o.svg.panzoom("pan",n.clientX,n.clientY,{relative:!0,animate:!0})}},100),e.isMovingToHighlightRoom=!1},o.mapMoved=function(){e.showMyPositionAfterFloorSwitch||a.deactivatePositioningButton()},o.mapZoomed=function(i,t,n){e.showMyPositionAfterFloorSwitch||a.deactivatePositioningButton(),Math.abs(n-o.data.tempScale)>.2&&(s(function(){o.data.hideRoomLabels=1>n,o.data.hideIconsAll=.6>n},100),o.data.tempScale=n)},o.showMyPosition=function(){if(void 0!=e.myPosition&&e.myPosition.floor==e.currentFloor)if(void 0===o.myPositionCircle||null===o.myPositionCircle){o.myPositionCircle=o.snapSvg.group();var i=o.myPositionCircle.circle(e.myPosition.x,e.myPosition.y,40),t=o.myPositionCircle.circle(e.myPosition.x,e.myPosition.y,10),n=o.myPositionCircle.circle(e.myPosition.x,e.myPosition.y,5);o.myPositionCircle.attr({id:"my-position-circle"}),i.addClass("surround"),t.addClass("animated infinite my-pos-pulse"),n.addClass("animated infinite my-pos-pulse delay")}else o.myPositionCircle.removeClass("hide")},o.hideMyPosition=function(){void 0!==o.myPositionCircle&&null!==o.myPositionCircle&&o.myPositionCircle.addClass("hide")},o.moveToMyPosition=function(){void 0!==e.myPosition&&null!==e.myPosition&&void 0!=o.myPositionCircle&&null!=o.myPositionCircle&&s(function(){o.svg.panzoom("zoom",1.5,{animate:!1});var i=$("#my-position-circle .surround");if(i.length>0){var t=i.position(),e={};e.clientX=r.innerWidth/2-(t.left+i.get(0).getBoundingClientRect().width/2),e.clientY=r.innerHeight/2-(t.top+i.get(0).getBoundingClientRect().height/2),o.svg.panzoom("pan",e.clientX,e.clientY,{relative:!0,animate:!0})}},100),e.isMovingToMyPosition=!1},o.paintRoute=function(){if(void 0!==o.lineToRoom&&null!==o.lineToRoom&&o.lineToRoom.remove(),void 0!==o.lineToPos&&null!==o.lineToPos&&o.lineToPos.remove(),void 0!==e.route&&null!==e.route){var i=o.snapSvg.selectAll(".path-line"),t=o.snapSvg.polygon([0,4,4,4,2,0,0,4]).addClass("arrow-marker").transform("r90"),n=o.snapSvg.polygon([0,4,4,4,2,0,0,4]).addClass("arrow-marker arrow-marker-inv").transform("r270"),a=t.marker(0,0,4,4,0,2),r=n.marker(0,0,4,4,0,2),s=null;$.each(i,function(o,i){i.removeClass("active")});for(var c=0;c<e.route.length;c++)null!=s&&$.each(i,function(o,i){var t=i.attr("id"),n="l-"+s+"-to-"+e.route[c],l="l-"+e.route[c]+"-to-"+s;(t===n||t===l)&&(i.addClass("active"),i.attr(t===n?{markerStart:a}:{markerStart:r}))}),s=e.route[c]}},o.$watch("data.zoom",function(){void 0!==o.svg&&o.svg.panzoom("zoom",.015*o.data.zoom+.5)}),o.$on("showMyPosition",function(){o.showMyPosition(),o.moveToMyPosition()}),o.$on("hightlightRoomOnSameFloor",function(){o.markRoomShape(),o.moveToRoomShape()}),o.$on("unhightlightRoom",function(){o.unmarkRoomShape()}),o.$on("mapTransition",function(){o.data.nextFloorIsHigher=e.nextFloorIsHigher}),o.$on("routeCalculated",function(){o.paintRoute()}),o.$on("hideIconsChanged",function(){o.data.hideIconsFood=e.hideIconsFood,o.data.hideIconsCopy=e.hideIconsCopy,o.data.hideIconsSurf=e.hideIconsSurf,o.data.hideIconsToilets=e.hideIconsToilets,o.data.hideIconsElevators=e.hideIconsElevators,o.data.hideIconsRecycle=e.hideIconsRecycle}),o.init()}]).service("MapService",["$rootScope","$location","RoomSearchService","$timeout","$window",function(o,i,t,e){var n=this;this.highlightRoom=function(i){this.dehighlightRoom(),this.isMovingToHighlightRoom=!0,this.roomToHighlight=i,i.floor!=this.currentFloor?e(function(){n.switchFloor(i.floor)},300):e(function(){o.$broadcast("hightlightRoomOnSameFloor")},300)},this.dehighlightRoom=function(){o.$broadcast("unhightlightRoom")},this.switchFloor=function(t){this.currentFloor!=t&&(this.nextFloorIsHigher=t>this.currentFloor,o.$broadcast("mapTransition"),i.path("/map/"+t))},this.showMyPosition=function(){var i={};i.floor=3,i.x=145,i.y=861,this.myPosition=i,this.isMovingToMyPosition=!0,this.myPosition.floor!=this.currentFloor?(this.showMyPositionAfterFloorSwitch=!0,this.switchFloor(this.myPosition.floor)):o.$broadcast("showMyPosition")},this.setHideIconsFood=function(i){this.hideIconsFood=i,o.$broadcast("hideIconsChanged")},this.setHideIconsCopy=function(i){this.hideIconsCopy=i,o.$broadcast("hideIconsChanged")},this.setHideIconsSurf=function(i){this.hideIconsSurf=i,o.$broadcast("hideIconsChanged")},this.setHideIconsToilets=function(i){this.hideIconsToilets=i,o.$broadcast("hideIconsChanged")},this.setHideIconsElevators=function(i){this.hideIconsElevators=i,o.$broadcast("hideIconsChanged")},this.setHideIconsRecycle=function(i){this.hideIconsRecycle=i,o.$broadcast("hideIconsChanged")},this.findRoute=function(i){this.showMyPosition();var i="3-1745-831",t=this.getRouteEndPoint();$.get("http://exohosting.ch/tonipathfinder/index.php?start="+i+"&end="+t,function(i){n.route=i.toString().split(","),o.$broadcast("routeCalculated")}).fail(function(){})},this.getRouteEndPoint=function(){var o=Snap('[id="'+this.roomToHighlight.planRoomNr+'"]');if(null!=o){var i=o.getBBox().cx,t=o.getBBox().cy,e=$(".path-point"),n=new Array;$.each(e,function(o,e){var a={};a.pointId=e.getAttribute("id");var r=i-e.getAttribute("cx"),s=t-e.getAttribute("cy");a.distance=Math.sqrt(r*r+s*s),n.push(a)}),n.sort(this.compareDistances)}var a=n[0].pointId.substr(2,n[0].pointId.length);return a},this.compareDistances=function(o,i){return o.distance<i.distance?-1:o.distance>i.distance?1:0}}]).directive("tmMap",function(){return{restrict:"E",template:'<div ng-include="data.svgUrl" include-replace onload="initSvg()"></div>',link:function(){}}}),angular.module("roomSearchModule",["ngResource","ng-iscroll"]).controller("RoomSearchController",["$scope","$http","$resource","RoomSearchService","MapService","$timeout","$window","ControlBarService",function(o,i,t,e,n,a,r,s){o.init=function(){o.resultlistheight={height:r.innerHeight-85+"px"},o.roomFindingActive=!1,o.roomSearchQuery="",o.$parent.myScrollOptions={"room-search-result-scroll-pane":{snap:!1,click:!0,onScrollEnd:function(){}}}},o.loadRoomSearchResults=function(){e.searchRooms(o.roomSearchQuery)},o.magnifierClicked=function(){$("input#room-search-box").focus()},o.roomSearchHasFocus=function(){e.setSearchActive(!0),o.resizeResultList()},o.roomSearchLoseFocus=function(){o.roomSearchQuery.length<=0?(e.setSearchActive(!1),o.resizeResultList()):o.roomSearchQuery="",e.rooms={},e.updateRoomList()},o.deactivateInputField=function(){o.resizeResultList()},o.selectRoom=function(i){e.setSearchActive(!1),e.setFindingActive(!0),n.highlightRoom(i),s.startRoomFindingMode(i),o.roomSearchQuery=null!=i.additionalDescription&&i.additionalDescription.length>0?i.additionalDescription:i.signalRoomNr,o.isSpecialRoom=null!=i.additionalDescription&&i.additionalDescription.length>0},o.roomFindCancel=function(){e.roomSearchActive&&e.roomFindingActive?o.roomSearchLoseFocus():(e.setFindingActive(!1),e.setSearchActive(!1),n.dehighlightRoom(),s.cancelRoomFindingMode())},o.resizeResultList=function(){o.resultlistheight={height:r.innerHeight-85+"px"},o.$parent.myScroll["room-search-result-scroll-pane"].refresh()},o.$on("roomListUpdated",function(){o.rooms=e.rooms,o.showList=o.rooms.length>0,o.showList&&a(function(){o.$parent.myScroll["room-search-result-scroll-pane"].refresh()},0)}),o.$on("roomSearchActiveChanged",function(){o.searchActive=e.roomSearchActive,o.searchActive||$("#room-search-box").blur()}),o.$on("roomFindingActiveChanged",function(){o.findingActive=e.roomFindingActive,o.findingActive||(o.roomSearchQuery="")}),o.init()}]).service("RoomSearchService",["$http","$resource","$rootScope",function(o,i,t){var e=this;o.defaults.useXDomain=!0,this.searchRooms=function(o){if(o.length>=3){var t=o.split(".").join("");t=t.replace(/\s/g,"");var n=i("http://exohosting.ch/toniareal/api/v1/rooms/all/:searchQuery",{searchQuery:"@searchQuery"});n.query({searchQuery:t}).$promise.then(function(o){e.rooms=o,e.isFavourites=!1,e.updateRoomList()})}else if(0==o.length){var n=i("http://exohosting.ch/toniareal/api/v1/rooms/favourites",{});n.query().$promise.then(function(o){e.rooms=o,e.isFavourites=!0,e.updateRoomList()})}else this.rooms={},this.isFavourites=!1,this.updateRoomList()},this.updateRoomList=function(){t.$broadcast("roomListUpdated")},this.setSearchActive=function(o){this.roomSearchActive=o,t.$broadcast("roomSearchActiveChanged")},this.setFindingActive=function(o){this.roomFindingActive=o,t.$broadcast("roomFindingActiveChanged")}}]).directive("tmRoomSearchResults",function(){return{restrict:"E",templateUrl:"build/templates/roomsearch/templates/results.template.html",link:function(){}}}).directive("tmRoomSearchResultItem",function(){return{restrict:"E",templateUrl:"build/templates/roomsearch/templates/resultitem.template.html"}}).directive("tmRoomSearchBox",function(){return{restrict:"E",templateUrl:"build/templates/roomsearch/templates/searchbox.template.html"}}),angular.module("sideMenuModule",[]).controller("SideMenuController",["$scope","ControlBarService","MapService",function(o,i,t){o.init=function(){o.data={},o.data.showSideMenu=!1,o.data.showIconsFood=!t.hideIconsFood,o.data.showIconsCopy=!t.hideIconsCopy,o.data.showIconsSurf=!t.hideIconsSurf,o.data.showIconsToilets=!t.hideIconsToilets,o.data.showIconsElevators=!t.hideIconsElevators,o.data.showIconsRecycle=!t.hideIconsRecycle},o.$on("sideMenuChanged",function(){o.data.showSideMenu=i.showSideMenu,o.data.showSideMenu?$("#wrapper-all").addClass("side-menu-offset"):$("#wrapper-all").removeClass("side-menu-offset")}),o.$watch("data.showIconsFood",function(){t.setHideIconsFood(!o.data.showIconsFood)}),o.$watch("data.showIconsCopy",function(){t.setHideIconsCopy(!o.data.showIconsCopy)}),o.$watch("data.showIconsSurf",function(){t.setHideIconsSurf(!o.data.showIconsSurf)}),o.$watch("data.showIconsToilets",function(){t.setHideIconsToilets(!o.data.showIconsToilets)}),o.$watch("data.showIconsElevators",function(){t.setHideIconsElevators(!o.data.showIconsElevators)}),o.$watch("data.showIconsRecycle",function(){t.setHideIconsRecycle(!o.data.showIconsRecycle)}),o.init()}]).directive("tmSideMenu",function(){return{restrict:"E",templateUrl:"build/templates/sidemenu/templates/sidemenu.template.html",link:function(){}}}),$(document).ready(function(){o(),$(window).resize(function(){o()}),document.addEventListener("touchmove",function(o){o.preventDefault()})});var i=new angular.module("toniMapsModule",["mapModule","roomSearchModule","controlBarModule","sideMenuModule","ngRoute","ngAnimate","ngAnimate-animate.css","helpers","nouislider","NgSwitchery"]);i.config(["$routeProvider",function(o){o.when("/map/:floor",{templateUrl:"build/views/map.view.html",controller:"MapController"}).otherwise({redirectTo:"/map/3"})}]).controller("WrapperController",["$scope","ControlBarService",function(o,i){o.toggleSideMenu=function(){i.toggleSideMenu()}}])}()}();